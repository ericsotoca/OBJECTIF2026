<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coach Mental Awal√© Pro</title>
    <style>
        /* --- Th√®mes et Variables CSS --- */
        :root {
            --font-main: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            --font-title: 'Trebuchet MS', Helvetica, sans-serif;
            --border-radius: 6px;
            --transition-speed: 0.3s;
        }

        [data-theme="light"] {
            --bg-primary: #f4f7f9; /* Blanc cass√© */
            --bg-secondary: #ffffff; /* Blanc pur */
            --bg-nav: #2c3e50; /* Bleu nuit */
            --text-primary: #333333;
            --text-secondary: #555555;
            --text-nav: #ecf0f1; /* Gris clair */
            --text-nav-active: #3498db; /* Bleu clair */
            --border-color: #dce4e8;
            --primary-accent: #3498db; /* Bleu clair */
            --secondary-accent: #2980b9; /* Bleu plus fonc√© */
            --danger-accent: #e74c3c; /* Rouge doux */
            --danger-accent-hover: #c0392b;
            --success-accent: #2ecc71; /* Vert */
            --warning-accent: #f39c12; /* Orange */
            --shadow-color: rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] {
            --bg-primary: #2c3e50; /* Bleu nuit */
            --bg-secondary: #34495e; /* Bleu/gris fonc√© */
            --bg-nav: #1f2b38; /* Plus fonc√© */
            --text-primary: #ecf0f1; /* Gris clair */
            --text-secondary: #bdc3c7; /* Gris moyen */
            --text-nav: #bdc3c7;
            --text-nav-active: #3498db; /* Bleu clair */
            --border-color: #4a627a;
            --primary-accent: #3498db;
            --secondary-accent: #5dade2; /* Bleu plus clair pour hover */
            --danger-accent: #e74c3c;
            --danger-accent-hover: #ff6b5a;
            --success-accent: #2ecc71;
            --warning-accent: #f1c40f; /* Jaune */
            --shadow-color: rgba(0, 0, 0, 0.3);
        }

        /* --- R√©initialisation et Styles de Base --- */
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            font-size: 16px;
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-main);
            line-height: 1.7;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: background-color var(--transition-speed) ease, color var(--transition-speed) ease;
            padding-top: 70px; /* Espace pour la nav fixe */
        }

        h1, h2, h3, h4 {
            font-family: var(--font-title);
            color: var(--primary-accent);
            margin-bottom: 1rem;
            line-height: 1.3;
        }
        h1 { font-size: 2rem; text-align: center; margin-top: 1rem;}
        h2 { font-size: 1.6rem; border-bottom: 2px solid var(--border-color); padding-bottom: 0.5rem; }
        h3 { font-size: 1.3rem; color: var(--secondary-accent); }
        h4 { font-size: 1.1rem; color: var(--text-secondary); }

        p {
            margin-bottom: 1rem;
            color: var(--text-secondary);
        }

        a {
            color: var(--primary-accent);
            text-decoration: none;
            transition: color var(--transition-speed) ease;
        }
        a:hover {
            color: var(--secondary-accent);
            text-decoration: underline;
        }

        ul {
            list-style: none;
            padding-left: 0;
            margin-bottom: 1rem;
        }

        /* --- Conteneurs et Mise en Page --- */
        .container {
            max-width: 900px;
            margin: 1.5rem auto;
            padding: 2rem;
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius);
            box-shadow: 0 4px 15px var(--shadow-color);
            transition: background-color var(--transition-speed) ease;
        }

        .section {
            display: none; /* Cach√© par d√©faut */
            padding-top: 1rem;
            animation: fadeIn 0.6s ease-in-out;
        }
        .section.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- Navigation Sup√©rieure --- */
        nav#top-nav {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: var(--bg-nav);
            padding: 0.5rem 1rem;
            box-shadow: 0 2px 8px var(--shadow-color);
            z-index: 1000;
            display: flex;
            justify-content: space-between; /* Ajust√© pour le toggle */
            align-items: center;
            flex-wrap: wrap; /* Pour les petits √©crans */
            transition: background-color var(--transition-speed) ease;
        }
        .nav-links {
             display: flex;
             flex-wrap: wrap;
        }

        nav#top-nav button.nav-btn {
            background: none;
            border: none;
            color: var(--text-nav);
            padding: 0.6rem 0.9rem;
            margin: 0.2rem; /* Espacement */
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            border-radius: var(--border-radius);
            transition: background-color var(--transition-speed) ease, color var(--transition-speed) ease;
            position: relative; /* Pour le pseudo-√©l√©ment */
            overflow: hidden;
        }

        nav#top-nav button.nav-btn::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 3px;
            background-color: var(--text-nav-active);
            transition: width var(--transition-speed) ease;
        }

        nav#top-nav button.nav-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        nav#top-nav button.nav-btn.active {
            color: var(--text-nav-active);
            font-weight: bold;
        }
         nav#top-nav button.nav-btn.active::after {
            width: 70%; /* Soulignement pour l'actif */
         }

        /* --- Boutons et Formulaires --- */
        button, .button {
            background-color: var(--primary-accent);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: background-color var(--transition-speed) ease, transform 0.1s ease;
            margin: 0.5rem 0.5rem 0.5rem 0; /* Espacement */
            display: inline-block; /* Pour les liens styl√©s comme boutons */
            text-align: center;
            vertical-align: middle;
        }
        button:hover:not(:disabled), .button:hover {
            background-color: var(--secondary-accent);
            transform: translateY(-2px);
            box-shadow: 0 2px 5px var(--shadow-color);
        }
        button:active:not(:disabled), .button:active {
             transform: translateY(0px);
        }

        button:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
            opacity: 0.7;
        }

        button.secondary { background-color: #7f8c8d; }
        button.secondary:hover:not(:disabled) { background-color: #95a5a6; }
        button.danger { background-color: var(--danger-accent); }
        button.danger:hover:not(:disabled) { background-color: var(--danger-accent-hover); }
        button.success { background-color: var(--success-accent); }
        button.success:hover:not(:disabled) { background-color: #27ae60; }


        textarea, input[type="text"], input[type="number"], input[type="date"], select {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
            font-family: inherit;
            font-size: 1rem;
            background-color: var(--bg-secondary); /* Pour th√®me sombre */
            color: var(--text-primary); /* Pour th√®me sombre */
            transition: border-color var(--transition-speed) ease, background-color var(--transition-speed) ease;
        }
        textarea:focus, input:focus, select:focus {
             outline: none;
             border-color: var(--primary-accent);
             box-shadow: 0 0 5px rgba(52, 152, 219, 0.5); /* Bleu clair */
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
            color: var(--text-secondary);
        }

        /* --- Listes Styl√©es --- */
        .styled-list li {
            background-color: var(--bg-primary); /* L√©g√®rement diff√©rent du fond principal */
            padding: 1rem 1.5rem;
            border: 1px solid var(--border-color);
            border-left: 5px solid var(--primary-accent);
            border-radius: var(--border-radius);
            margin-bottom: 0.8rem;
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color var(--transition-speed) ease, border-color var(--transition-speed) ease;
            word-wrap: break-word; /* Pour les longs textes */
            overflow: hidden; /* Cache le texte trop long */
        }

         .list-item-content {
            flex-grow: 1;
            margin-right: 1rem; /* Espace avant les boutons */
            overflow: hidden;
             text-overflow: ellipsis;
             /* white-space: nowrap; */ /* Optionnel: force une seule ligne */
         }
         .list-item-content strong { color: var(--primary-accent); }
         .list-item-content em { color: var(--text-secondary); font-size: 0.9em; }


        .list-item-actions button {
            padding: 0.3rem 0.6rem; /* Petits boutons */
            font-size: 0.8rem;
            margin-left: 0.3rem;
        }

        .delete-btn {
            background-color: var(--danger-accent);
            min-width: 30px; /* Taille fixe */
        }
         .delete-btn:hover {
            background-color: var(--danger-accent-hover);
         }
        .complete-btn {
            background-color: var(--success-accent);
            min-width: 30px;
        }
         .complete-btn:hover {
            background-color: #27ae60;
         }
         .styled-list li.completed {
             border-left-color: var(--success-accent);
             opacity: 0.7;
         }
         .styled-list li.completed .list-item-content {
             text-decoration: line-through;
         }


        /* --- Module Pression: Respiration --- */
        .breathing-controls { text-align: center; margin-bottom: 1.5rem; }
        .breathing-controls button { margin: 0.5rem; }

        #breathing-visualizer {
            width: 150px;
            height: 150px;
            background-color: var(--primary-accent);
            border-radius: 50%;
            margin: 2rem auto;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 1rem;
            text-align: center;
            transition: transform 1.5s ease-in-out, background-color 1s ease;
            box-shadow: 0 0 20px rgba(52, 152, 219, 0.5);
        }
        #breathing-instruction { font-weight: bold; font-size: 1.1rem; margin-bottom: 0.3rem; }
        #breathing-timer { font-size: 1.8rem; font-weight: bold; color: var(--secondary-accent); margin-top: 1rem; text-align: center; }

        /* --- Module Concentration: Pomodoro --- */
        .pomodoro-explanation {
            background-color: var(--bg-primary);
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 1.5rem;
            border: 1px solid var(--border-color);
            font-size: 0.95rem;
        }
        #focus-timer-display {
            font-size: 4rem;
            font-weight: bold;
            text-align: center;
            margin: 1.5rem 0;
            color: var(--primary-accent);
            font-family: 'Courier New', Courier, monospace; /* Police diff√©rente pour le temps */
        }
        .timer-controls {
            text-align: center;
            margin-bottom: 1rem;
        }
         .timer-controls button {
             margin: 0.5rem; /* Plus d'espace */
             min-width: 120px; /* Largeur minimale */
         }
        #focus-status {
            text-align: center;
            margin-top: 1rem;
            font-style: italic;
            font-weight: bold;
            color: var(--secondary-accent);
            min-height: 1.5em; /* Evite les sauts de layout */
        }

        /* --- Module Concentration: Jeu --- */
        #concentration-game-area {
            width: 100%;
            height: 300px;
            background-color: var(--bg-primary);
            border: 2px dashed var(--border-color);
            border-radius: var(--border-radius);
            margin-top: 1.5rem;
            position: relative;
            overflow: hidden; /* Important pour positionner la cible */
            cursor: crosshair;
        }
        #game-target {
            width: 40px;
            height: 40px;
            background-color: var(--danger-accent);
            border-radius: 50%;
            position: absolute;
            cursor: pointer;
            display: none; /* Cach√© au d√©but */
            transition: background-color 0.2s ease;
             box-shadow: 0 0 10px var(--danger-accent);
        }
         #game-target:hover {
             background-color: var(--danger-accent-hover);
         }
        #game-info { text-align: center; margin-top: 1rem; font-weight: bold; }


         /* --- Module Humeur --- */
         .mood-tracker {
            text-align: center;
            margin-bottom: 1.5rem;
         }
         .mood-options button {
            font-size: 1.5rem; /* Emojis plus gros */
            padding: 0.5rem;
            background: none;
            border: 2px solid transparent;
            border-radius: 50%;
             margin: 0 0.5rem;
            transition: border-color var(--transition-speed);
         }
         .mood-options button:hover {
            transform: scale(1.1);
         }
         .mood-options button.selected {
             border-color: var(--primary-accent);
             box-shadow: 0 0 10px var(--primary-accent);
         }


        /* --- Theme Toggle --- */
        #theme-toggle {
            background: none;
            border: 1px solid var(--text-nav);
            color: var(--text-nav);
            padding: 0.4rem 0.8rem;
            font-size: 0.8rem;
            cursor: pointer;
            border-radius: var(--border-radius);
            transition: all var(--transition-speed) ease;
        }
        #theme-toggle:hover {
             background-color: var(--primary-accent);
             border-color: var(--primary-accent);
             color: white;
        }

        /* --- Utilitaires --- */
        .hidden { display: none; }
        .center-text { text-align: center; }
        .mt-1 { margin-top: 1rem; }
        .mt-2 { margin-top: 2rem; }
        .mb-1 { margin-bottom: 1rem; }
        .mb-2 { margin-bottom: 2rem; }

        /* --- Responsive Design --- */
        @media (max-width: 768px) {
            body { padding-top: 100px; /* Plus d'espace si la nav s'√©tend */ }
            .container { padding: 1.5rem; margin: 1rem; }
            h1 { font-size: 1.8rem; }
            h2 { font-size: 1.4rem; }
            nav#top-nav { padding: 0.5rem; justify-content: center; } /* Centre les √©l√©ments sur petit √©cran */
             .nav-links { justify-content: center; width: 100%;}
            #theme-toggle { /* Position peut changer si besoin */
                 margin-top: 0.5rem;
            }
            .styled-list li { flex-direction: column; align-items: flex-start; }
            .list-item-actions { margin-top: 0.5rem; width: 100%; text-align: right; }
            .list-item-content { margin-right: 0; /* Prend toute la largeur */ }
        }
         @media (max-width: 480px) {
             body { padding-top: 120px; }
             h1 { font-size: 1.6rem; }
             button, .button { width: 100%; margin: 0.5rem 0; /* Boutons pleine largeur */ }
             .timer-controls button { min-width: auto; }
             #focus-timer-display { font-size: 3rem; }
             #breathing-visualizer { width: 120px; height: 120px; }
         }

    </style>
</head>
<body data-theme="light"> <!-- Th√®me par d√©faut -->

    <!-- Navigation Principale -->
    <nav id="top-nav">
        <div class="nav-links">
             <button class="nav-btn" data-section="accueil">üè† Accueil</button>
             <button class="nav-btn" data-section="pression">üßò Pression</button>
             <button class="nav-btn" data-section="confiance">üí™ Confiance</button>
             <button class="nav-btn" data-section="resilience">üå± R√©silience</button>
             <button class="nav-btn" data-section="concentration">üéØ Concentration</button>
             <button class="nav-btn" data-section="objectifs">üèÅ Objectifs</button>
             <button class="nav-btn" data-section="affirmations">‚ú® Affirmations</button>
             <button class="nav-btn" data-section="humeur">üòä Humeur</button>
             <button class="nav-btn" data-section="aide">‚ùì Aide</button>
             <button class="nav-btn" data-section="parametres">‚öôÔ∏è Param√®tres</button>
        </div>
         <button id="theme-toggle">‚òÄÔ∏è / üåô</button>
    </nav>

    <main class="container">
        <h1 id="main-title">Accueil</h1>

        <!-- ========== Section Accueil ========== -->
        <section id="section-accueil" class="section active">
            <h2>Bienvenue sur votre Coach Mental Awal√© Pro !</h2>
            <p>Cette application est votre partenaire pour aiguiser votre esprit et aborder vos comp√©titions d'Awal√© avec s√©r√©nit√© et d√©termination.</p>
            <p>Explorez les diff√©rentes sections via le menu ci-dessus pour acc√©der √† des outils et exercices cibl√©s :</p>
            <ul>
                <li>üßò <strong>Gestion de la Pression :</strong> Apprenez √† respirer et √† visualiser pour rester calme.</li>
                <li>üí™ <strong>Confiance en Soi :</strong> Renforcez votre assurance en reconnaissant vos succ√®s et forces.</li>
                <li> R√©si <strong>R√©silience :</strong> Transformez les d√©faites en opportunit√©s d'apprentissage.</li>
                <li>üéØ <strong>Concentration :</strong> Am√©liorez votre focus avec le minuteur Pomodoro et des exercices.</li>
                <li>üèÅ <strong>Objectifs :</strong> D√©finissez et suivez vos objectifs de pr√©paration mentale.</li>
                <li>‚ú® <strong>Affirmations :</strong> Cultivez un √©tat d'esprit positif.</li>
                <li>üòä <strong>Suivi d'Humeur :</strong> Prenez conscience de votre √©tat mental au fil du temps.</li>
                <li>‚ùì <strong>Aide :</strong> Comprenez le fonctionnement de chaque module.</li>
                 <li>‚öôÔ∏è <strong>Param√®tres :</strong> G√©rez vos donn√©es et pr√©f√©rences.</li>
            </ul>
            <hr class="mt-2 mb-2">
            <h3>Pens√©e du Jour :</h3>
            <blockquote id="quote-display" style="font-style: italic; border-left: 3px solid var(--primary-accent); padding-left: 1rem;">
                "Le mental est le muscle le plus important dans les jeux de r√©flexion."
            </blockquote>
        </section>

        <!-- ========== Section Gestion de la Pression ========== -->
        <section id="section-pression" class="section">
            <h2>üßò Gestion de la Pression</h2>
            <p>Ma√Ætrisez votre calme int√©rieur pour performer sous pression.</p>

            <h3>Respiration Guid√©e</h3>
            <p>Choisissez un exercice pour recentrer votre attention et calmer votre syst√®me nerveux. Cliquez sur un bouton pour d√©marrer.</p>
            <div class="breathing-controls">
                <button id="btn-breath-box" class="secondary">Carr√©e (4-4-4-4)</button>
                <button id="btn-breath-478" class="secondary">Relaxante (4-7-8)</button>
                <button id="btn-breath-stop" class="danger" disabled>Arr√™ter</button>
            </div>
            <div id="breathing-visualizer">
                <span id="breathing-instruction">Pr√™t ?</span>
            </div>
            <div id="breathing-timer">00:00</div>

            <hr class="mt-2 mb-2">

            <h3>Visualisation Positive</h3>
            <p>Cr√©ez ou chargez un sc√©nario mental de succ√®s pour renforcer votre confiance et pr√©parer votre esprit √† la victoire.</p>
            <label for="visualization-text">Mon Sc√©nario de Visualisation :</label>
            <textarea id="visualization-text" rows="7" placeholder="D√©crivez une partie id√©ale : votre calme, votre concentration, vos bons coups, le sentiment de ma√Ætrise et de succ√®s..."></textarea>
            <button id="btn-save-visualization" class="success">üíæ Sauvegarder</button>
            <button id="btn-load-visualization">üîÑ Charger</button>
        </section>

        <!-- ========== Section Confiance en Soi ========== -->
        <section id="section-confiance" class="section">
            <h2>üí™ Confiance en Soi</h2>
            <p>Nourrissez votre confiance en reconnaissant vos accomplissements et vos qualit√©s.</p>

            <h3>Journal des Succ√®s</h3>
            <p>Chaque victoire, m√™me petite, compte. Notez-les ici.</p>
            <label for="success-entry">Nouveau Succ√®s / Bon coup / Fiert√© :</label>
            <textarea id="success-entry" rows="3" placeholder="Ex: J'ai bien d√©fendu une case faible contre M... / J'ai gard√© mon calme apr√®s une erreur..."></textarea>
            <button id="btn-add-success" class="success">‚ûï Ajouter au Journal</button>
            <h4 class="mt-1">Mes Succ√®s Enregistr√©s :</h4>
            <ul id="success-list" class="styled-list">Chargement...</ul>

            <hr class="mt-2 mb-2">

            <h3>Inventaire de Mes Forces</h3>
            <p>Identifiez et rappelez-vous de vos atouts sp√©cifiques √† l'Awal√©.</p>
            <label for="strength-entry">Ajouter une Force :</label>
            <textarea id="strength-entry" rows="3" placeholder="Ex: Calcul rapide des Krou, vision √† long terme, gestion du temps..."></textarea>
            <button id="btn-add-strength" class="success">‚ûï Ajouter une Force</button>
            <h4 class="mt-1">Mes Forces Identifi√©es :</h4>
            <ul id="strength-list" class="styled-list">Chargement...</ul>
        </section>

        <!-- ========== Section R√©silience ========== -->
        <section id="section-resilience" class="section">
            <h2> R√©si R√©silience</h2> <!-- R√©si -> R√©silience -->
            <p>Apprenez de chaque partie, surtout des d√©faites, pour revenir plus fort.</p>

            <h3>Analyse Constructive Post-Partie</h3>
            <p>Utilisez ce formulaire pour analyser une partie (gagn√©e ou perdue) de mani√®re objective.</p>
            <form id="defeat-analysis-form">
                 <label for="analysis-date">Date de la partie :</label>
                 <input type="date" id="analysis-date" required>

                 <label for="analysis-opponent">Adversaire / Contexte :</label>
                 <input type="text" id="analysis-opponent" placeholder="Ex: Tournoi Y, Partie 3 vs Z / Entra√Ænement">

                 <label for="analysis-result">R√©sultat (Optionnel) :</label>
                 <input type="text" id="analysis-result" placeholder="Ex: Victoire, D√©faite, Nulle / Score">

                 <label for="analysis-positive">‚úÖ Points Positifs / Ce qui a bien fonctionn√© :</label>
                 <textarea id="analysis-positive" rows="3"></textarea>

                 <label for="analysis-keymoment">üîë Moment(s) Cl√©(s) / Point(s) √† am√©liorer :</label>
                 <textarea id="analysis-keymoment" rows="3"></textarea>

                 <label for="analysis-learning">üí° Principal Apprentissage / Le√ßon Retenue :</label>
                 <textarea id="analysis-learning" rows="3"></textarea>

                 <label for="analysis-next">üöÄ Actions Concr√®tes pour la Prochaine Fois :</label>
                 <textarea id="analysis-next" rows="3"></textarea>

                <button type="submit" class="success">üíæ Sauvegarder l'Analyse</button>
                <button type="reset" class="secondary">Effacer le Formulaire</button>
            </form>
            <h4 class="mt-2">Mes Analyses Pr√©c√©dentes :</h4>
            <ul id="analysis-list" class="styled-list">Chargement...</ul>
        </section>

        <!-- ========== Section Concentration ========== -->
        <section id="section-concentration" class="section">
            <h2>üéØ Concentration & Endurance Mentale</h2>
            <p>Entra√Ænez votre capacit√© √† rester focalis√© pendant de longues p√©riodes.</p>

             <h3>Minuteur de Focus (Technique Pomodoro)</h3>
             <div class="pomodoro-explanation">
                 <p><strong>Comment √ßa marche ?</strong> La technique Pomodoro aide √† maintenir une concentration √©lev√©e en alternant des p√©riodes de travail intense avec de courtes pauses.</p>
                 <ol>
                     <li>Choisissez une t√¢che (ex: √©tudier une ouverture, analyser une partie).</li>
                     <li>Lancez le minuteur "Travail" (typiquement 25 min).</li>
                     <li>Travaillez intens√©ment sur la t√¢che, sans interruption.</li>
                     <li>Quand le minuteur sonne, prenez une pause courte (5 min).</li>
                     <li>Apr√®s 4 "Pomodoros" (cycles travail/pause courte), prenez une pause plus longue (15-30 min).</li>
                 </ol>
                 <p>Utilisez les boutons ci-dessous pour g√©rer vos sessions.</p>
             </div>

             <div id="focus-timer-display">25:00</div>
             <div class="timer-controls">
                 <button id="btn-focus-start" title="D√©marrer une session de travail de 25 min">üíº Travail (25m)</button>
                 <button id="btn-focus-pause" title="Mettre en pause ou reprendre le minuteur">‚èØÔ∏è Pause/Rep.</button>
                 <button id="btn-focus-reset" class="secondary" title="R√©initialiser le minuteur √† 25 min">üîÑ Reset</button>
                 <br> <!-- Force un retour ligne pour les pauses -->
                 <button id="btn-focus-short-break" class="success" title="D√©marrer une pause courte de 5 min">‚òï Pause (5m)</button>
                 <button id="btn-focus-long-break" class="success" title="D√©marrer une pause longue de 15 min">üö∂ Pause Longue (15m)</button>
             </div>
             <div id="focus-status">Pr√™t √† d√©marrer une session de travail.</div>

             <hr class="mt-2 mb-2">

             <h3>Mini-Jeu de Concentration : Cible Rapide</h3>
             <p>Testez et am√©liorez votre vitesse de r√©action et votre focus visuel. Cliquez sur la cible rouge d√®s qu'elle appara√Æt !</p>
             <button id="btn-start-game" class="secondary">üöÄ Lancer le Jeu (10 cibles)</button>
             <div id="concentration-game-area">
                 <div id="game-target"></div>
             </div>
             <div id="game-info">Score : 0 | Temps moyen : N/A ms</div>

        </section>

        <!-- ========== Section Objectifs ========== -->
        <section id="section-objectifs" class="section">
            <h2>üèÅ Objectifs Mentaux</h2>
            <p>D√©finissez des objectifs clairs pour votre pr√©paration mentale.</p>
             <label for="goal-entry">Nouvel Objectif :</label>
            <textarea id="goal-entry" rows="3" placeholder="Ex: M√©diter 5 min avant chaque session d'entra√Ænement / Analyser 3 de mes d√©faites cette semaine / Rester positif m√™me si je perds des graines en d√©but de partie..."></textarea>
            <button id="btn-add-goal" class="success">‚ûï Ajouter l'Objectif</button>
             <h4 class="mt-1">Mes Objectifs Actuels :</h4>
            <ul id="goal-list" class="styled-list">Chargement...</ul>
        </section>

        <!-- ========== Section Affirmations ========== -->
        <section id="section-affirmations" class="section">
            <h2>‚ú® Affirmations Positives</h2>
            <p>R√©p√©tez ces phrases pour cultiver un √©tat d'esprit fort et positif.</p>
            <div id="affirmation-display" style="font-size: 1.4rem; font-style: italic; text-align: center; margin: 2rem 0; padding: 1rem; border: 1px solid var(--border-color); border-radius: var(--border-radius); background-color: var(--bg-primary);">
                "Chargement d'une affirmation..."
            </div>
            <div class="center-text">
                <button id="btn-next-affirmation">üîÑ Autre Affirmation</button>
            </div>

            <hr class="mt-2 mb-2">

            <h3>Mes Affirmations Personnalis√©es</h3>
             <label for="affirmation-entry">Ajouter une affirmation personnelle :</label>
            <textarea id="affirmation-entry" rows="2" placeholder="Ex: Je suis capable de calculs complexes / Chaque partie m'apprend quelque chose..."></textarea>
            <button id="btn-add-affirmation" class="success">‚ûï Ajouter</button>
            <h4 class="mt-1">Mes Affirmations :</h4>
            <ul id="affirmation-list" class="styled-list">Chargement...</ul>
        </section>

        <!-- ========== Section Humeur ========== -->
        <section id="section-humeur" class="section">
             <h2>üòä Suivi d'Humeur & Focus</h2>
             <p>Prenez un instant pour √©valuer votre √©tat mental avant ou apr√®s une session.</p>

             <div class="mood-tracker">
                 <label>Comment vous sentez-vous maintenant ? (Focus / √ânergie)</label>
                 <div class="mood-options mb-1">
                     <button data-mood="1" title="Tr√®s faible">üò©</button>
                     <button data-mood="2" title="Faible">üòü</button>
                     <button data-mood="3" title="Moyen">üòê</button>
                     <button data-mood="4" title="Bon">üôÇ</button>
                     <button data-mood="5" title="Excellent">üòÉ</button>
                 </div>
                 <label for="mood-note">Note rapide (optionnel) :</label>
                 <input type="text" id="mood-note" placeholder="Ex: Fatigu√© apr√®s entra√Ænement / Pr√™t pour la partie !">
                 <button id="btn-save-mood" class="success">üíæ Enregistrer l'Humeur</button>
             </div>

             <h4 class="mt-2">Historique d'Humeur :</h4>
             <ul id="mood-history-list" class="styled-list">Chargement...</ul>
        </section>

        <!-- ========== Section Aide ========== -->
        <section id="section-aide" class="section">
            <h2>‚ùì Aide & Informations</h2>
            <p>Comprendre les outils de votre Coach Mental.</p>

            <article class="mb-2">
                <h3>üßò Gestion de la Pression</h3>
                <p><strong>Respiration Guid√©e :</strong> Synchronisez votre souffle avec les instructions visuelles (Inspirez, Retenez, Expirez). La respiration Carr√©e (4-4-4-4) √©quilibre, la Relaxante (4-7-8) calme profond√©ment. Cliquez sur le bouton correspondant pour d√©marrer.</p>
                <p><strong>Visualisation :</strong> √âcrivez des sc√©narios o√π vous r√©ussissez. Relisez-les r√©guli√®rement pour programmer votre esprit au succ√®s.</p>
            </article>

             <article class="mb-2">
                 <h3>üí™ Confiance & R√©si R√©silience</h3> <!-- R√©si -> R√©silience -->
                 <p><strong>Journal des Succ√®s & Forces :</strong> Notez activement vos points positifs pour contrer le biais de n√©gativit√©. Relisez-les avant les comp√©titions.</p>
                 <p><strong>Analyse Post-Partie :</strong> Soyez honn√™te mais constructif. L'objectif est d'apprendre, pas de vous bl√¢mer. Concentrez-vous sur les "le√ßons retenues" et les "actions concr√®tes".</p>
             </article>

             <article class="mb-2">
                 <h3>üéØ Concentration</h3>
                 <p><strong>Minuteur Pomodoro :</strong> Id√©al pour les sessions d'√©tude ou d'analyse. L'alternance travail/pause optimise l'endurance mentale. Utilisez les boutons pour lancer les diff√©rents types de minuteurs (Travail, Pause Courte, Pause Longue).</p>
                 <p><strong>Jeu Cible Rapide :</strong> Un exercice simple pour am√©liorer la vitesse de r√©action et la concentration visuelle. Cliquez sur "Lancer le Jeu" et cliquez sur la cible rouge le plus vite possible.</p>
             </article>

            <article class="mb-2">
                 <h3>üèÅ Objectifs, ‚ú® Affirmations, üòä Humeur</h3>
                <p><strong>Objectifs :</strong> Rendez vos buts de pr√©paration mentale concrets et mesurables.</p>
                <p><strong>Affirmations :</strong> Utilisez le pouvoir des mots pour influencer positivement votre √©tat d'esprit.</p>
                <p><strong>Humeur :</strong> Suivre votre √©tat vous aide √† identifier des tendances et √† mieux comprendre ce qui influence votre performance.</p>
            </article>
             <article>
                 <h3>‚öôÔ∏è Param√®tres</h3>
                 <p>G√©rez vos donn√©es stock√©es localement et changez le th√®me de l'application.</p>
             </article>
        </section>

         <!-- ========== Section Param√®tres ========== -->
        <section id="section-parametres" class="section">
            <h2>‚öôÔ∏è Param√®tres & Gestion des Donn√©es</h2>

             <h3>Th√®me de l'Application</h3>
             <p>Choisissez votre apparence pr√©f√©r√©e.</p>
             <button id="btn-set-light-theme">‚òÄÔ∏è Th√®me Clair</button>
             <button id="btn-set-dark-theme">üåô Th√®me Sombre</button>

             <hr class="mt-2 mb-2">

            <h3>Gestion des Donn√©es Utilisateur</h3>
            <p>Vos donn√©es (succ√®s, analyses, etc.) sont stock√©es <strong>uniquement dans votre navigateur</strong> sur cet appareil. Elles ne sont pas envoy√©es ailleurs.</p>
            <p>‚ö†Ô∏è Vider le cache de votre navigateur ou utiliser un autre appareil effacera vos donn√©es enregistr√©es.</p>

            <div style="margin-top: 1.5rem;">
                <button id="btn-export-data" class="secondary">üì§ Exporter mes Donn√©es</button>
                <label for="import-file-input" class="button secondary mt-1" style="cursor: pointer;">
                    üì• Importer des Donn√©es
                </label>
                 <input type="file" id="import-file-input" accept=".json" style="display: none;">
                 <p id="import-status" style="font-size: 0.9em; margin-top: 0.5em;"></p>
            </div>

            <div style="margin-top: 2rem; border: 2px solid var(--danger-accent); padding: 1rem; border-radius: var(--border-radius);">
                <h4 style="color: var(--danger-accent);">Zone Dangereuse</h4>
                <p>Cette action est irr√©versible et supprimera toutes vos donn√©es enregistr√©es dans cette application.</p>
                <button id="btn-delete-all-data" class="danger">üóëÔ∏è Supprimer Toutes Mes Donn√©es</button>
            </div>
        </section>


    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Configuration ---
            const POMODORO_DEFAULTS = {
                work: 25 * 60,
                shortBreak: 5 * 60,
                longBreak: 15 * 60
            };
            const DEFAULT_AFFIRMATIONS = [
                "Je suis calme et concentr√©(e) sous pression.",
                "Chaque partie est une opportunit√© d'apprendre.",
                "Je fais confiance √† mon intuition et √† mon calcul.",
                "Je suis capable de surmonter les d√©fis.",
                "Ma pr√©paration mentale me donne un avantage.",
                "J'aborde chaque coup avec clart√©.",
                "Je suis r√©silient(e) face aux erreurs et aux d√©faites.",
                "Je visualise mon succ√®s.",
                "Mon esprit est mon meilleur atout.",
                "Je joue avec plaisir et d√©termination."
            ];
            const MOOD_EMOJIS = { 1: 'üò©', 2: 'üòü', 3: 'üòê', 4: 'üôÇ', 5: 'üòÉ' };

            // --- DOM Elements ---
            const body = document.body;
            const navButtons = document.querySelectorAll('#top-nav .nav-btn');
            const sections = document.querySelectorAll('.section');
            const mainTitle = document.getElementById('main-title');
            const themeToggle = document.getElementById('theme-toggle');
            const btnSetLightTheme = document.getElementById('btn-set-light-theme');
            const btnSetDarkTheme = document.getElementById('btn-set-dark-theme');

            // Accueil
            const quoteDisplay = document.getElementById('quote-display');

            // Pression
            const btnBreathBox = document.getElementById('btn-breath-box');
            const btnBreath478 = document.getElementById('btn-breath-478');
            const btnBreathStop = document.getElementById('btn-breath-stop');
            const visualizer = document.getElementById('breathing-visualizer');
            const breathTimerDisplay = document.getElementById('breathing-timer');
            const breathInstruction = document.getElementById('breathing-instruction');
            const visualizationText = document.getElementById('visualization-text');
            const btnSaveVisualization = document.getElementById('btn-save-visualization');
            const btnLoadVisualization = document.getElementById('btn-load-visualization');

            // Confiance
            const successEntry = document.getElementById('success-entry');
            const btnAddSuccess = document.getElementById('btn-add-success');
            const successList = document.getElementById('success-list');
            const strengthEntry = document.getElementById('strength-entry');
            const btnAddStrength = document.getElementById('btn-add-strength');
            const strengthList = document.getElementById('strength-list');

            // R√©silience
            const defeatForm = document.getElementById('defeat-analysis-form');
            const analysisList = document.getElementById('analysis-list');
            const analysisDate = document.getElementById('analysis-date');
            const analysisOpponent = document.getElementById('analysis-opponent');
             const analysisResult = document.getElementById('analysis-result');
            const analysisPositive = document.getElementById('analysis-positive');
            const analysisKeyMoment = document.getElementById('analysis-keymoment');
            const analysisLearning = document.getElementById('analysis-learning');
            const analysisNext = document.getElementById('analysis-next');

            // Concentration
            const focusTimerDisplay = document.getElementById('focus-timer-display');
            const btnFocusStart = document.getElementById('btn-focus-start');
            const btnFocusPause = document.getElementById('btn-focus-pause');
            const btnFocusReset = document.getElementById('btn-focus-reset');
            const btnFocusShortBreak = document.getElementById('btn-focus-short-break');
            const btnFocusLongBreak = document.getElementById('btn-focus-long-break');
            const focusStatus = document.getElementById('focus-status');
            // Concentration Game
            const btnStartGame = document.getElementById('btn-start-game');
            const gameArea = document.getElementById('concentration-game-area');
            const gameTarget = document.getElementById('game-target');
            const gameInfo = document.getElementById('game-info');

            // Objectifs
            const goalEntry = document.getElementById('goal-entry');
            const btnAddGoal = document.getElementById('btn-add-goal');
            const goalList = document.getElementById('goal-list');

            // Affirmations
            const affirmationDisplay = document.getElementById('affirmation-display');
            const btnNextAffirmation = document.getElementById('btn-next-affirmation');
            const affirmationEntry = document.getElementById('affirmation-entry');
            const btnAddAffirmation = document.getElementById('btn-add-affirmation');
            const affirmationList = document.getElementById('affirmation-list');

             // Humeur
            const moodOptionsContainer = document.querySelector('.mood-options');
            const moodNote = document.getElementById('mood-note');
            const btnSaveMood = document.getElementById('btn-save-mood');
            const moodHistoryList = document.getElementById('mood-history-list');
             let selectedMood = null; // Pour stocker l'humeur s√©lectionn√©e

             // Param√®tres
            const btnExportData = document.getElementById('btn-export-data');
            const importFileInput = document.getElementById('import-file-input');
            const importStatus = document.getElementById('import-status');
            const btnDeleteAllData = document.getElementById('btn-delete-all-data');


            // --- State Variables ---
            let breathInterval = null;
            let breathTotalSeconds = 0;
            let breathCycle = [];
            let breathCurrentPhaseIndex = 0;
            let breathPhaseTimer = 0;

            let focusInterval = null;
            let focusTotalSeconds = POMODORO_DEFAULTS.work;
            let focusIsRunning = false;
            let focusCurrentMode = 'Travail'; // Travail, Pause Courte, Pause Longue

            // Concentration Game State
            let gameScore = 0;
            let gameTargetCount = 0;
            let gameStartTime = 0;
            let gameReactionTimes = [];
            let gameTimeoutId = null;

            // --- Local Storage Keys ---
            const STORAGE_KEYS = {
                THEME: 'awale_mental_theme',
                VISUALIZATION: 'awale_mental_visualization',
                SUCCESSES: 'awale_mental_successes',
                STRENGTHS: 'awale_mental_strengths',
                ANALYSES: 'awale_mental_analyses',
                GOALS: 'awale_mental_goals',
                AFFIRMATIONS: 'awale_mental_affirmations',
                MOOD_HISTORY: 'awale_mental_mood_history',
                 // Cl√© unique pour regrouper toutes les donn√©es pour l'export
                ALL_DATA: 'awale_mental_all_data'
            };

             // --- Helper Functions ---
            function saveData(key, data) {
                try {
                    localStorage.setItem(key, JSON.stringify(data));
                    //console.log(`Data saved for key: ${key}`);
                } catch (e) {
                    console.error("Error saving data to localStorage:", e);
                    alert("Erreur lors de la sauvegarde des donn√©es. Le stockage local est peut-√™tre plein ou indisponible.");
                }
            }

            function loadData(key, defaultValue = []) {
                try {
                    const data = localStorage.getItem(key);
                    //console.log(`Data loaded for key ${key}:`, data);
                    return data ? JSON.parse(data) : defaultValue;
                } catch (e) {
                    console.error(`Error loading data from localStorage for key ${key}:`, e);
                    // Si erreur de parsing, retourne la valeur par d√©faut pour √©viter de planter l'app
                    return defaultValue;
                }
            }

             function formatTime(seconds) {
                 const mins = Math.floor(seconds / 60);
                 const secs = seconds % 60;
                 return `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
             }

             // Fonction g√©n√©rique pour rendre des listes styl√©es
             // `data` est un tableau d'objets
             // `listElement` est l'√©l√©ment UL
             // `renderItemFn` est une fonction qui prend un item et retourne le contenu HTML du LI (sans la balise LI elle-m√™me)
             // `storageKey` est la cl√© pour la sauvegarde apr√®s suppression/modification
             // `options` peut contenir { deletable: true, completable: true, itemClass: '...' }
             function renderStyledList(data, listElement, renderItemFn, storageKey, options = {}) {
                 if (!listElement) {
                     console.warn(`List element not found for key ${storageKey}`);
                     return;
                 }
                 listElement.innerHTML = ''; // Clear previous items
                 if (data.length === 0) {
                     listElement.innerHTML = '<li>Aucun √©l√©ment √† afficher.</li>';
                     return;
                 }

                 data.forEach((item, index) => {
                     const li = document.createElement('li');
                     if (options.itemClass) li.classList.add(options.itemClass);
                     if (item.completed && options.completable) li.classList.add('completed');

                      // Contenu principal de l'item
                     const contentDiv = document.createElement('div');
                     contentDiv.classList.add('list-item-content');
                     contentDiv.innerHTML = renderItemFn(item); // Appel de la fonction de rendu sp√©cifique
                     li.appendChild(contentDiv);

                     // Conteneur pour les boutons d'action
                     const actionsDiv = document.createElement('div');
                     actionsDiv.classList.add('list-item-actions');

                      // Bouton Compl√©ter/D√©compl√©ter
                     if (options.completable) {
                         const completeBtn = document.createElement('button');
                         completeBtn.textContent = item.completed ? '‚úÖ' : '‚¨ú'; // Ou 'R√©activer' / 'Terminer'
                         completeBtn.title = item.completed ? "Marquer comme non termin√©" : "Marquer comme termin√©";
                         completeBtn.classList.add('complete-btn', 'secondary'); // Utilise une classe plus neutre
                         completeBtn.addEventListener('click', () => {
                             item.completed = !item.completed;
                             saveData(storageKey, data);
                             renderStyledList(data, listElement, renderItemFn, storageKey, options); // Re-render
                         });
                         actionsDiv.appendChild(completeBtn);
                     }

                     // Bouton Supprimer
                     if (options.deletable !== false) { // Deletable par d√©faut
                         const deleteBtn = document.createElement('button');
                         deleteBtn.textContent = '‚ùå'; // Ou 'Suppr.'
                         deleteBtn.title = "Supprimer cet √©l√©ment";
                         deleteBtn.classList.add('delete-btn', 'danger');
                         deleteBtn.addEventListener('click', () => {
                             if (confirm('Voulez-vous vraiment supprimer cet √©l√©ment ?')) {
                                 data.splice(index, 1);
                                 saveData(storageKey, data);
                                 renderStyledList(data, listElement, renderItemFn, storageKey, options); // Re-render
                             }
                         });
                         actionsDiv.appendChild(deleteBtn);
                     }


                     li.appendChild(actionsDiv);
                     listElement.appendChild(li);
                 });
             }


            // --- Navigation Logic ---
            function setActiveSection(sectionId) {
                //console.log(`Activating section: ${sectionId}`);
                let foundSection = false;
                sections.forEach(section => {
                    const isActive = section.id === `section-${sectionId}`;
                    section.classList.toggle('active', isActive);
                    if (isActive) foundSection = true;
                });

                if (!foundSection) {
                    console.warn(`Section with id "section-${sectionId}" not found. Activating accueil.`);
                    setActiveSection('accueil'); // Fallback vers l'accueil
                    return;
                }

                navButtons.forEach(button => {
                    const isActive = button.dataset.section === sectionId;
                    button.classList.toggle('active', isActive);
                     if (isActive) {
                         // Met √† jour le titre principal (en retirant l'emoji si pr√©sent)
                         mainTitle.textContent = button.textContent.replace(/^[^\w]+/, '').trim();
                     }
                });
                window.scrollTo(0, 0); // Scroll vers le haut
            }

            navButtons.forEach(button => {
                button.addEventListener('click', () => {
                    if (!button.dataset.section) {
                        console.error("Button missing data-section attribute:", button);
                        return;
                    }
                    setActiveSection(button.dataset.section);
                });
            });

            // --- Theme Management ---
            function applyTheme(theme) {
                body.dataset.theme = theme;
                saveData(STORAGE_KEYS.THEME, theme);
                 themeToggle.textContent = theme === 'light' ? 'üåô Sombre' : '‚òÄÔ∏è Clair';
                 console.log(`Theme applied: ${theme}`);
            }

            themeToggle.addEventListener('click', () => {
                const currentTheme = body.dataset.theme || 'light';
                applyTheme(currentTheme === 'light' ? 'dark' : 'light');
            });
            // Boutons d√©di√©s dans les param√®tres
             btnSetLightTheme.addEventListener('click', () => applyTheme('light'));
             btnSetDarkTheme.addEventListener('click', () => applyTheme('dark'));

            // Load initial theme
            const savedTheme = loadData(STORAGE_KEYS.THEME, 'light');
            applyTheme(savedTheme);

             // --- Gestion de la Pression Logic ---
             function stopBreathingExercise() {
                 clearInterval(breathInterval);
                 breathInterval = null;
                 visualizer.style.transform = 'scale(1)';
                 visualizer.style.backgroundColor = 'var(--primary-accent)'; // Couleur de base
                 breathInstruction.textContent = 'Pr√™t ?';
                 breathTimerDisplay.textContent = '00:00';
                 // R√©active les boutons de d√©marrage, d√©sactive stop
                 btnBreathBox.disabled = false;
                 btnBreath478.disabled = false;
                 btnBreathStop.disabled = true;
                 console.log("Breathing exercise stopped.");
             }

             function updateBreathVisuals(phase) {
                 breathInstruction.textContent = `${phase.action} (${phase.duration}s)`;
                 visualizer.style.backgroundColor = `var(--${phase.color || 'primary-accent'})`;
                 visualizer.style.transform = `scale(${phase.scale || 1})`;
             }

            function updateBreathTimer() {
                 breathTotalSeconds++;
                 breathTimerDisplay.textContent = formatTime(breathTotalSeconds);

                 if (breathCycle.length > 0) {
                     breathPhaseTimer--;
                     if (breathPhaseTimer <= 0) {
                         // Next phase
                         breathCurrentPhaseIndex = (breathCurrentPhaseIndex + 1) % breathCycle.length;
                         const currentPhase = breathCycle[breathCurrentPhaseIndex];
                         breathPhaseTimer = currentPhase.duration;
                         updateBreathVisuals(currentPhase);
                         //console.log(`Phase: ${currentPhase.action}, Duration: ${currentPhase.duration}`);
                     }
                 }
             }

             function startBreathingExercise(cycle) {
                 console.log("Starting breathing exercise:", cycle.map(p => p.action));
                 stopBreathingExercise(); // Ensure any previous one is stopped
                 breathCycle = cycle;
                 breathCurrentPhaseIndex = -1; // Will be incremented to 0 on first tick
                 breathPhaseTimer = 1; // Start immediately
                 breathTotalSeconds = -1; // Will be incremented to 0 on first tick

                 // Disable start buttons, enable stop button
                 btnBreathBox.disabled = true;
                 btnBreath478.disabled = true;
                 btnBreathStop.disabled = false;

                 updateBreathTimer(); // Initial call to set first phase
                 breathInterval = setInterval(updateBreathTimer, 1000);
             }

             btnBreathBox.addEventListener('click', () => {
                 startBreathingExercise([
                     { action: 'Inspirez', duration: 4, scale: 1.2, color: 'success-accent' },
                     { action: 'Retenez', duration: 4, scale: 1.2, color: 'warning-accent' },
                     { action: 'Expirez', duration: 4, scale: 0.8, color: 'secondary-accent' },
                     { action: 'Retenez', duration: 4, scale: 0.8, color: 'warning-accent' }
                 ]);
             });

             btnBreath478.addEventListener('click', () => {
                 startBreathingExercise([
                     { action: 'Inspirez', duration: 4, scale: 1.2, color: 'success-accent' },
                     { action: 'Retenez', duration: 7, scale: 1.2, color: 'warning-accent' },
                     { action: 'Expirez', duration: 8, scale: 0.8, color: 'secondary-accent' }
                 ]);
             });

             btnBreathStop.addEventListener('click', stopBreathingExercise);

             // Visualisation
             btnSaveVisualization.addEventListener('click', () => {
                 saveData(STORAGE_KEYS.VISUALIZATION, visualizationText.value);
                 alert('Visualisation sauvegard√©e !');
             });
             btnLoadVisualization.addEventListener('click', () => {
                 const loadedText = loadData(STORAGE_KEYS.VISUALIZATION, '');
                 visualizationText.value = loadedText;
                  if(!loadedText) alert('Aucune visualisation sauvegard√©e trouv√©e.');
             });
             // Load visualization on section activation
              // (Moved to the loadAllData function for consistency)


            // --- Confiance Logic ---
            // Succ√®s (tableau de strings)
            function renderSuccessItem(item) { return item; } // Simple string item
            function loadAndRenderSuccesses() {
                const successes = loadData(STORAGE_KEYS.SUCCESSES, []);
                renderStyledList(successes, successList, renderSuccessItem, STORAGE_KEYS.SUCCESSES, { deletable: true, itemClass: 'success-item' });
            }
            btnAddSuccess.addEventListener('click', () => {
                const entry = successEntry.value.trim();
                if (entry) {
                    const successes = loadData(STORAGE_KEYS.SUCCESSES, []);
                    successes.unshift(entry); // Add to beginning
                    saveData(STORAGE_KEYS.SUCCESSES, successes);
                    renderStyledList(successes, successList, renderSuccessItem, STORAGE_KEYS.SUCCESSES, { deletable: true, itemClass: 'success-item' });
                    successEntry.value = '';
                } else { alert('Veuillez entrer un succ√®s.'); }
            });

            // Forces (tableau de strings)
            function renderStrengthItem(item) { return item; } // Simple string item
            function loadAndRenderStrengths() {
                 const strengths = loadData(STORAGE_KEYS.STRENGTHS, []);
                 renderStyledList(strengths, strengthList, renderStrengthItem, STORAGE_KEYS.STRENGTHS, { deletable: true, itemClass: 'strength-item' });
            }
            btnAddStrength.addEventListener('click', () => {
                const entry = strengthEntry.value.trim();
                if (entry) {
                    const strengths = loadData(STORAGE_KEYS.STRENGTHS, []);
                    strengths.unshift(entry);
                    saveData(STORAGE_KEYS.STRENGTHS, strengths);
                    renderStyledList(strengths, strengthList, renderStrengthItem, STORAGE_KEYS.STRENGTHS, { deletable: true, itemClass: 'strength-item' });
                    strengthEntry.value = '';
                } else { alert('Veuillez entrer une force.'); }
            });


            // --- R√©silience Logic ---
            // Analyses (tableau d'objets)
            function renderAnalysisItem(item) {
                 // Format date nicely
                 const date = item.date ? new Date(item.date).toLocaleDateString('fr-FR', { year: 'numeric', month: 'short', day: 'numeric' }) : 'Date inconnue';
                 return `<strong>${item.opponent || 'Analyse'} (${date})</strong> - ${item.result || ''}<br>
                         <em>Apprentissage cl√© : ${item.learning || 'Non sp√©cifi√©'}</em>`;
            }
             function loadAndRenderAnalyses() {
                 const analyses = loadData(STORAGE_KEYS.ANALYSES, []);
                 renderStyledList(analyses, analysisList, renderAnalysisItem, STORAGE_KEYS.ANALYSES, { deletable: true, itemClass: 'analysis-item' });
             }

             defeatForm.addEventListener('submit', (e) => {
                 e.preventDefault();
                  if (!analysisDate.value) {
                     alert("Veuillez s√©lectionner une date pour l'analyse.");
                     analysisDate.focus();
                     return;
                  }

                 const analysisData = {
                     id: Date.now(), // Simple unique ID
                     date: analysisDate.value,
                     opponent: analysisOpponent.value.trim(),
                     result: analysisResult.value.trim(),
                     positive: analysisPositive.value.trim(),
                     keyMoment: analysisKeyMoment.value.trim(),
                     learning: analysisLearning.value.trim(),
                     nextSteps: analysisNext.value.trim()
                 };

                 const analyses = loadData(STORAGE_KEYS.ANALYSES, []);
                 analyses.unshift(analysisData); // Add to beginning
                 saveData(STORAGE_KEYS.ANALYSES, analyses);
                 renderStyledList(analyses, analysisList, renderAnalysisItem, STORAGE_KEYS.ANALYSES, { deletable: true, itemClass: 'analysis-item' });
                 defeatForm.reset();
                 alert("Analyse sauvegard√©e !");
             });

             // Set default date to today for analysis form
             analysisDate.valueAsDate = new Date();


             // --- Concentration: Pomodoro Logic ---
             function enableFocusStartButtons() {
                 btnFocusStart.disabled = false;
                 btnFocusShortBreak.disabled = false;
                 btnFocusLongBreak.disabled = false;
                 btnFocusPause.textContent = '‚èØÔ∏è Pause/Rep.'; // Reset pause button text
                 btnFocusPause.disabled = true; // Disable pause when no timer is running
             }
             function disableFocusStartButtons() {
                 btnFocusStart.disabled = true;
                 btnFocusShortBreak.disabled = true;
                 btnFocusLongBreak.disabled = true;
                 btnFocusPause.disabled = false; // Enable pause when timer is running
             }

             function updateFocusTimer() {
                 if (focusTotalSeconds > 0) {
                     focusTotalSeconds--;
                     focusTimerDisplay.textContent = formatTime(focusTotalSeconds);
                 } else {
                     clearInterval(focusInterval);
                     focusInterval = null;
                     focusIsRunning = false;
                     focusTimerDisplay.textContent = "00:00";
                     focusStatus.textContent = `üèÅ ${focusCurrentMode} termin√© ! Pr√™t pour la suite.`;
                     enableFocusStartButtons();
                     alert(`${focusCurrentMode} termin√© !`);
                     // Ajouter une notification visuelle ou sonore ici si d√©sir√©
                 }
             }

             function startFocusTimer(durationSeconds, mode) {
                 console.log(`Starting Pomodoro: ${mode} (${durationSeconds}s)`);
                 clearInterval(focusInterval);
                 focusTotalSeconds = durationSeconds;
                 focusCurrentMode = mode;
                 focusIsRunning = true;
                 focusTimerDisplay.textContent = formatTime(focusTotalSeconds);
                 focusStatus.textContent = `‚è≥ ${mode} en cours...`;
                 disableFocusStartButtons();
                 focusInterval = setInterval(updateFocusTimer, 1000);
             }

             function toggleFocusPause() {
                 if (!focusInterval && !focusIsRunning && focusTotalSeconds <= 0) return; // Ne rien faire si le timer est fini

                 if (focusIsRunning) {
                     // Pause
                     clearInterval(focusInterval);
                     focusInterval = null;
                     focusIsRunning = false;
                     focusStatus.textContent += " (‚è∏Ô∏è En pause)";
                     btnFocusPause.textContent = '‚ñ∂Ô∏è Reprendre';
                     console.log("Pomodoro paused.");
                 } else {
                     // Resume
                     focusIsRunning = true;
                     focusStatus.textContent = `‚è≥ ${focusCurrentMode} en cours...`; // Restore status
                     btnFocusPause.textContent = '‚èØÔ∏è Pause/Rep.';
                     focusInterval = setInterval(updateFocusTimer, 1000);
                     console.log("Pomodoro resumed.");
                 }
             }

             function resetFocusTimer(defaultSeconds = POMODORO_DEFAULTS.work, defaultMode = 'Travail') {
                 console.log("Resetting Pomodoro timer.");
                 clearInterval(focusInterval);
                 focusInterval = null;
                 focusIsRunning = false;
                 focusTotalSeconds = defaultSeconds;
                 focusCurrentMode = defaultMode;
                 focusTimerDisplay.textContent = formatTime(focusTotalSeconds);
                 focusStatus.textContent = "Pr√™t √† d√©marrer une session.";
                 enableFocusStartButtons();
             }

             btnFocusStart.addEventListener('click', () => startFocusTimer(POMODORO_DEFAULTS.work, 'Travail'));
             btnFocusShortBreak.addEventListener('click', () => startFocusTimer(POMODORO_DEFAULTS.shortBreak, 'Pause Courte'));
             btnFocusLongBreak.addEventListener('click', () => startFocusTimer(POMODORO_DEFAULTS.longBreak, 'Pause Longue'));
             btnFocusPause.addEventListener('click', toggleFocusPause);
             btnFocusReset.addEventListener('click', () => resetFocusTimer());

             // --- Concentration: Game Logic ---
             function showTarget() {
                 const areaRect = gameArea.getBoundingClientRect();
                 const targetSize = 40; // Doit correspondre au CSS
                 // Position al√©atoire, en s'assurant qu'elle reste dans les limites
                 const top = Math.random() * (areaRect.height - targetSize);
                 const left = Math.random() * (areaRect.width - targetSize);

                 gameTarget.style.top = `${top}px`;
                 gameTarget.style.left = `${left}px`;
                 gameTarget.style.display = 'block';
                 gameStartTime = Date.now(); // D√©marrer le chrono pour cette cible
             }

             function targetClicked() {
                 if (!gameStartTime) return; // √âvite les clics multiples

                 const reactionTime = Date.now() - gameStartTime;
                 gameReactionTimes.push(reactionTime);
                 gameScore++;
                 gameTargetCount--;
                 gameTarget.style.display = 'none'; // Cacher la cible
                 gameStartTime = 0; // R√©initialiser pour la prochaine cible

                 updateGameInfo();

                 if (gameTargetCount > 0) {
                      // D√©lai al√©atoire avant la prochaine cible
                     clearTimeout(gameTimeoutId); // Clear previous timeout if any
                     gameTimeoutId = setTimeout(showTarget, Math.random() * 1500 + 500); // Entre 0.5 et 2 secondes
                 } else {
                     // Fin du jeu
                     btnStartGame.disabled = false;
                     btnStartGame.textContent = "üöÄ Relancer le Jeu (10 cibles)";
                     const avgTime = gameReactionTimes.reduce((a, b) => a + b, 0) / gameReactionTimes.length;
                     gameInfo.textContent += ` | Jeu Termin√© ! Temps Moyen : ${avgTime.toFixed(0)} ms`;
                     alert(`Jeu termin√© !\nScore : ${gameScore}/10\nTemps de r√©action moyen : ${avgTime.toFixed(0)} ms`);
                 }
             }

             function updateGameInfo() {
                 const avgTime = gameReactionTimes.length > 0 ? (gameReactionTimes.reduce((a, b) => a + b, 0) / gameReactionTimes.length).toFixed(0) : 'N/A';
                 gameInfo.textContent = `Score : ${gameScore} | Cibles restantes : ${gameTargetCount} | Temps moyen : ${avgTime} ms`;
             }

             function startGame() {
                 console.log("Starting concentration game.");
                 gameScore = 0;
                 gameTargetCount = 10; // Nombre de cibles
                 gameReactionTimes = [];
                 gameStartTime = 0;
                 btnStartGame.disabled = true;
                 btnStartGame.textContent = "üïπÔ∏è Jeu en cours...";
                 updateGameInfo();
                 clearTimeout(gameTimeoutId); // Clear previous timeout
                 gameTimeoutId = setTimeout(showTarget, 1000); // Premi√®re cible apr√®s 1s
             }

             btnStartGame.addEventListener('click', startGame);
             gameTarget.addEventListener('click', targetClicked);

             // --- Objectifs Logic ---
             // Objectifs (tableau d'objets { id, text, completed })
              function renderGoalItem(item) { return item.text; }
              function loadAndRenderGoals() {
                  const goals = loadData(STORAGE_KEYS.GOALS, []);
                  renderStyledList(goals, goalList, renderGoalItem, STORAGE_KEYS.GOALS, {
                      deletable: true,
                      completable: true, // Active la fonctionnalit√© de compl√©tion
                      itemClass: 'goal-item'
                  });
              }

              btnAddGoal.addEventListener('click', () => {
                  const text = goalEntry.value.trim();
                  if (text) {
                      const goals = loadData(STORAGE_KEYS.GOALS, []);
                      const newGoal = { id: Date.now(), text: text, completed: false };
                      goals.unshift(newGoal);
                      saveData(STORAGE_KEYS.GOALS, goals);
                      loadAndRenderGoals(); // Re-render
                      goalEntry.value = '';
                  } else { alert('Veuillez entrer un objectif.'); }
              });

             // --- Affirmations Logic ---
              function renderAffirmationItem(item) { return item.text; } // Objet { id, text }
              function loadAndRenderAffirmations() {
                  const userAffirmations = loadData(STORAGE_KEYS.AFFIRMATIONS, []);
                  renderStyledList(userAffirmations, affirmationList, renderAffirmationItem, STORAGE_KEYS.AFFIRMATIONS, { deletable: true, itemClass: 'affirmation-item' });
                  showRandomAffirmation(); // Met √† jour l'affichage principal
              }

             function showRandomAffirmation() {
                 const userAffirmations = loadData(STORAGE_KEYS.AFFIRMATIONS, []);
                 const allAffirmations = [...DEFAULT_AFFIRMATIONS, ...userAffirmations.map(a => a.text)];
                 if (allAffirmations.length > 0) {
                     const randomIndex = Math.floor(Math.random() * allAffirmations.length);
                     affirmationDisplay.textContent = `"${allAffirmations[randomIndex]}"`;
                 } else {
                     affirmationDisplay.textContent = "Ajoutez vos propres affirmations !";
                 }
             }

             btnAddAffirmation.addEventListener('click', () => {
                 const text = affirmationEntry.value.trim();
                 if (text) {
                     const userAffirmations = loadData(STORAGE_KEYS.AFFIRMATIONS, []);
                      // V√©rifier si l'affirmation existe d√©j√† (optionnel)
                      if (userAffirmations.some(a => a.text.toLowerCase() === text.toLowerCase())) {
                          alert("Cette affirmation existe d√©j√†.");
                          return;
                      }
                     const newAffirmation = { id: Date.now(), text: text };
                     userAffirmations.unshift(newAffirmation);
                     saveData(STORAGE_KEYS.AFFIRMATIONS, userAffirmations);
                     loadAndRenderAffirmations(); // Re-render list and potentially update main display
                     affirmationEntry.value = '';
                 } else { alert('Veuillez entrer une affirmation.'); }
             });

             btnNextAffirmation.addEventListener('click', showRandomAffirmation);


            // --- Humeur Logic ---
            function renderMoodItem(item) {
                const date = new Date(item.timestamp).toLocaleString('fr-FR', { dateStyle: 'short', timeStyle: 'short' });
                const emoji = MOOD_EMOJIS[item.mood] || '‚ùì';
                return `${emoji} (${item.mood}/5) - <strong>${date}</strong><br><em>${item.note || 'Aucune note'}</em>`;
            }

             function loadAndRenderMoodHistory() {
                 const history = loadData(STORAGE_KEYS.MOOD_HISTORY, []);
                 // Trie l'historique par date d√©croissante (plus r√©cent en premier)
                 history.sort((a, b) => b.timestamp - a.timestamp);
                 renderStyledList(history, moodHistoryList, renderMoodItem, STORAGE_KEYS.MOOD_HISTORY, { deletable: true, itemClass: 'mood-item' });
             }

             // G√©rer la s√©lection d'humeur visuellement
             moodOptionsContainer.addEventListener('click', (e) => {
                 if (e.target.tagName === 'BUTTON' && e.target.dataset.mood) {
                     // D√©s√©lectionner les autres
                     moodOptionsContainer.querySelectorAll('button').forEach(btn => btn.classList.remove('selected'));
                     // S√©lectionner le bouton cliqu√©
                     e.target.classList.add('selected');
                     selectedMood = parseInt(e.target.dataset.mood, 10);
                     console.log("Mood selected:", selectedMood);
                 }
             });

             btnSaveMood.addEventListener('click', () => {
                 if (selectedMood === null) {
                     alert("Veuillez s√©lectionner une humeur (cliquez sur un emoji).");
                     return;
                 }
                 const note = moodNote.value.trim();
                 const moodEntry = {
                     id: Date.now(),
                     timestamp: Date.now(),
                     mood: selectedMood,
                     note: note
                 };

                 const history = loadData(STORAGE_KEYS.MOOD_HISTORY, []);
                 history.push(moodEntry); // Ajoute √† la fin, sera tri√© √† l'affichage
                 saveData(STORAGE_KEYS.MOOD_HISTORY, history);
                 loadAndRenderMoodHistory(); // Re-render

                 // R√©initialiser la s√©lection
                 moodOptionsContainer.querySelectorAll('button').forEach(btn => btn.classList.remove('selected'));
                 selectedMood = null;
                 moodNote.value = '';
                 alert("Humeur enregistr√©e !");
             });

             // --- Param√®tres: Data Management ---
             function getAllAppData() {
                 const allData = {};
                 for (const key in STORAGE_KEYS) {
                      // Exclut la cl√© ALL_DATA elle-m√™me et le th√®me pour l'export/import de *contenu*
                     if (key !== 'ALL_DATA' && key !== 'THEME') {
                          // Utilise la cl√© courte comme nom dans l'objet JSON
                         allData[STORAGE_KEYS[key]] = loadData(STORAGE_KEYS[key], (key === 'VISUALIZATION' ? '' : [])); // G√®re valeur par d√©faut string ou array
                     }
                 }
                 return allData;
             }

            btnExportData.addEventListener('click', () => {
                 try {
                     const dataToExport = getAllAppData();
                     const dataStr = JSON.stringify(dataToExport, null, 2); // Pretty print JSON
                     const dataBlob = new Blob([dataStr], { type: 'application/json' });
                     const url = URL.createObjectURL(dataBlob);
                     const link = document.createElement('a');
                     link.href = url;
                     const timestamp = new Date().toISOString().slice(0, 10); // YYYY-MM-DD
                     link.download = `awale_mental_data_${timestamp}.json`;
                     document.body.appendChild(link);
                     link.click();
                     document.body.removeChild(link);
                     URL.revokeObjectURL(url);
                     console.log("Data exported successfully.");
                     alert("Donn√©es export√©es avec succ√®s sous forme de fichier JSON.");
                 } catch (e) {
                     console.error("Error exporting data:", e);
                     alert("Une erreur est survenue lors de l'exportation des donn√©es.");
                 }
             });

             importFileInput.addEventListener('change', (event) => {
                 const file = event.target.files[0];
                 if (!file) {
                     importStatus.textContent = "Aucun fichier s√©lectionn√©.";
                     return;
                 }
                 if (file.type !== 'application/json') {
                      importStatus.textContent = "Erreur : Le fichier doit √™tre au format JSON.";
                      return;
                 }

                 const reader = new FileReader();
                 reader.onload = (e) => {
                     try {
                         const importedData = JSON.parse(e.target.result);
                         console.log("Data read from file:", importedData);

                         // Valider et importer les donn√©es
                         let importedCount = 0;
                         let skippedCount = 0;
                         for (const key in importedData) {
                             // V√©rifie si la cl√© import√©e correspond √† une cl√© attendue
                             if (Object.values(STORAGE_KEYS).includes(key)) {
                                  // Valider le type de donn√©es (simple v√©rification)
                                  const expectedType = (key === STORAGE_KEYS.VISUALIZATION) ? 'string' : 'object'; // Array is an object
                                  if ( (typeof importedData[key] === expectedType) || (expectedType === 'object' && Array.isArray(importedData[key]) ) ) {
                                        saveData(key, importedData[key]);
                                        importedCount++;
                                  } else {
                                      console.warn(`Skipping import for key ${key}: unexpected data type ${typeof importedData[key]}. Expected ${expectedType}.`);
                                      skippedCount++;
                                  }

                             } else {
                                 console.warn(`Skipping import for unknown key: ${key}`);
                                 skippedCount++;
                             }
                         }

                         importStatus.textContent = `Importation termin√©e. ${importedCount} ensemble(s) de donn√©es import√©(s), ${skippedCount} ignor√©(s). Rechargez l'application pour voir les changements.`;
                         alert("Donn√©es import√©es ! Il est recommand√© de rafra√Æchir la page (F5) pour appliquer tous les changements.");
                         // R√©initialiser l'input pour permettre de r√©importer le m√™me fichier si besoin
                         importFileInput.value = null;
                          // Recharger toutes les donn√©es affich√©es
                          loadAllData();

                     } catch (err) {
                         console.error("Error parsing imported JSON:", err);
                         importStatus.textContent = "Erreur : Impossible de lire le fichier JSON. Est-il valide ?";
                         alert("Erreur lors de la lecture du fichier JSON. Assurez-vous qu'il est correctement format√©.");
                     }
                 };
                 reader.onerror = () => {
                      console.error("Error reading file");
                      importStatus.textContent = "Erreur lors de la lecture du fichier.";
                      alert("Une erreur s'est produite lors de la lecture du fichier.");
                 };
                 reader.readAsText(file);
             });


            btnDeleteAllData.addEventListener('click', () => {
                if (confirm("‚ö†Ô∏è ATTENTION ! √ätes-vous absolument s√ªr(e) de vouloir supprimer TOUTES vos donn√©es ? Cette action est IRR√âVERSIBLE.")) {
                    if (confirm("Seconde confirmation : Vraiment s√ªr(e) ? Toutes vos analyses, succ√®s, objectifs, etc., seront perdus.")) {
                        console.warn("Deleting all user data from localStorage...");
                        let deletedCount = 0;
                         for (const key in STORAGE_KEYS) {
                             // Ne supprime pas la cl√© du th√®me pour garder la pr√©f√©rence
                             if (key !== 'THEME' && key !== 'ALL_DATA') {
                                 localStorage.removeItem(STORAGE_KEYS[key]);
                                 deletedCount++;
                             }
                         }
                        console.log(`${deletedCount} data keys removed.`);
                        alert("Toutes les donn√©es ont √©t√© supprim√©es. L'application va se recharger.");
                        // Recharger l'application pour refl√©ter les changements
                        location.reload();
                    }
                }
            });

             // --- Initialisation & Chargement des Donn√©es ---
             function loadAllData() {
                 console.log("Loading all initial data...");
                 // Accueil
                 showRandomAffirmation(); // Pour la citation du jour

                  // Pression
                 visualizationText.value = loadData(STORAGE_KEYS.VISUALIZATION, '');

                 // Confiance
                 loadAndRenderSuccesses();
                 loadAndRenderStrengths();

                 // R√©silience
                 loadAndRenderAnalyses();

                 // Concentration (Pomodoro & Game)
                 resetFocusTimer(); // Initialise l'affichage Pomodoro
                 updateGameInfo(); // Initialise l'affichage du jeu

                 // Objectifs
                 loadAndRenderGoals();

                 // Affirmations
                 loadAndRenderAffirmations(); // Charge la liste et affiche une al√©atoire

                 // Humeur
                 loadAndRenderMoodHistory();

                 // Set default active section
                 setActiveSection('accueil');
                 console.log("Initial data load complete.");
             }

             // Execute initial load
             loadAllData();

        }); // Fin DOMContentLoaded
    </script>

</body>
</html>
