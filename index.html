<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coach Mental Awalé Pro</title>
    <style>
        /* --- Thèmes et Variables CSS --- */
        :root {
            --font-main: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            --font-title: 'Trebuchet MS', Helvetica, sans-serif;
            --border-radius: 6px;
            --transition-speed: 0.3s;
            --nav-height-desktop: 60px; /* Hauteur nav sur grand écran */
            --nav-height-mobile: 50px;  /* Hauteur nav sur petit écran */
        }

        [data-theme="light"] {
            --bg-primary: #f4f7f9; /* Blanc cassé */
            --bg-secondary: #ffffff; /* Blanc pur */
            --bg-nav: #2c3e50; /* Bleu nuit */
            --text-primary: #333333;
            --text-secondary: #555555;
            --text-nav: #ecf0f1; /* Gris clair */
            --text-nav-active: #3498db; /* Bleu clair */
            --border-color: #dce4e8;
            --primary-accent: #3498db; /* Bleu clair */
            --secondary-accent: #2980b9; /* Bleu plus foncé */
            --danger-accent: #e74c3c; /* Rouge doux */
            --danger-accent-hover: #c0392b;
            --success-accent: #2ecc71; /* Vert */
            --warning-accent: #f39c12; /* Orange */
            --shadow-color: rgba(0, 0, 0, 0.1);
            --slide-bg: #e9ecef; /* Fond légèrement gris pour slide */
        }

        [data-theme="dark"] {
            --bg-primary: #2c3e50; /* Bleu nuit */
            --bg-secondary: #34495e; /* Bleu/gris foncé */
            --bg-nav: #1f2b38; /* Plus foncé */
            --text-primary: #ecf0f1; /* Gris clair */
            --text-secondary: #bdc3c7; /* Gris moyen */
            --text-nav: #bdc3c7;
            --text-nav-active: #3498db; /* Bleu clair */
            --border-color: #4a627a;
            --primary-accent: #3498db;
            --secondary-accent: #5dade2; /* Bleu plus clair pour hover */
            --danger-accent: #e74c3c;
            --danger-accent-hover: #ff6b5a;
            --success-accent: #2ecc71;
            --warning-accent: #f1c40f; /* Jaune */
            --shadow-color: rgba(0, 0, 0, 0.3);
             --slide-bg: #495057; /* Fond gris foncé pour slide */
        }

        /* --- Réinitialisation et Styles de Base --- */
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        html { font-size: 16px; scroll-behavior: smooth; }
        body {
             padding-top: var(--nav-height-desktop); /* Espace pour la nav fixe */
             font-family: var(--font-main); line-height: 1.7;
             background-color: var(--bg-primary); color: var(--text-primary);
             transition: background-color var(--transition-speed) ease, color var(--transition-speed) ease;
        }
        h1, h2, h3, h4 { font-family: var(--font-title); color: var(--primary-accent); margin-bottom: 1rem; line-height: 1.3; }
        h1 { font-size: 2rem; text-align: center; margin-top: 1rem;}
        h2 { font-size: 1.6rem; border-bottom: 2px solid var(--border-color); padding-bottom: 0.5rem; }
        h3 { font-size: 1.3rem; color: var(--secondary-accent); }
        h4 { font-size: 1.1rem; color: var(--text-secondary); }
        p { margin-bottom: 1rem; color: var(--text-secondary); }
        a { color: var(--primary-accent); text-decoration: none; transition: color var(--transition-speed) ease; }
        a:hover { color: var(--secondary-accent); text-decoration: underline; }
        ul { list-style: none; padding-left: 0; margin-bottom: 1rem; }

        /* --- Conteneurs et Mise en Page --- */
        .container { max-width: 900px; margin: 1.5rem auto; padding: 2rem; background-color: var(--bg-secondary); border-radius: var(--border-radius); box-shadow: 0 4px 15px var(--shadow-color); transition: background-color var(--transition-speed) ease; }
        .section { display: none; padding-top: 1rem; animation: fadeIn 0.6s ease-in-out; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

        /* --- Navigation Supérieure avec Sous-Menus --- */
        nav#top-nav { position: fixed; top: 0; left: 0; width: 100%; background-color: var(--bg-nav); padding: 0 1rem; box-shadow: 0 2px 8px var(--shadow-color); z-index: 1000; display: flex; justify-content: space-between; align-items: center; min-height: var(--nav-height-desktop); transition: background-color var(--transition-speed) ease; }
        .main-nav-list { display: flex; align-items: center; height: 100%; }
        .main-nav-list > li { position: relative; height: 100%; display: flex; align-items: center; }
        .main-nav-list > li > button, .main-nav-list > li > a { display: flex; align-items: center; background: none; border: none; color: var(--text-nav); padding: 0 1rem; height: 100%; font-size: 0.95rem; font-weight: 500; cursor: pointer; text-decoration: none; transition: background-color var(--transition-speed) ease, color var(--transition-speed) ease; white-space: nowrap; }
        .main-nav-list > li > button:hover, .main-nav-list > li > a:hover, .main-nav-list > li.active > button, .main-nav-list > li.active > a { background-color: rgba(255, 255, 255, 0.1); color: var(--text-nav-active); }
        .main-nav-list > li > button.nav-btn.active { background-color: rgba(255, 255, 255, 0.1); color: var(--text-nav-active); font-weight: bold; }
        .dropdown-menu { display: none; position: absolute; top: 100%; left: 0; background-color: var(--bg-nav); min-width: 200px; border-radius: 0 0 var(--border-radius) var(--border-radius); box-shadow: 0 4px 10px var(--shadow-color); padding: 0.5rem 0; z-index: 1001; animation: fadeInDown 0.3s ease-out; }
        .main-nav-list > li.active .dropdown-menu { display: block; }
        @keyframes fadeInDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .dropdown-menu li button.nav-btn { display: block; width: 100%; background: none; border: none; color: var(--text-nav); padding: 0.7rem 1.5rem; font-size: 0.9rem; text-align: left; cursor: pointer; transition: background-color var(--transition-speed) ease, color var(--transition-speed) ease; }
        .dropdown-menu li button.nav-btn:hover { background-color: rgba(255, 255, 255, 0.15); color: var(--text-nav-active); }
        .dropdown-menu li button.nav-btn.active { color: var(--text-nav-active); font-weight: bold; background-color: rgba(52, 152, 219, 0.2); }

        /* --- Boutons et Formulaires --- */
        button, .button { background-color: var(--primary-accent); color: white; border: none; padding: 0.8rem 1.5rem; border-radius: var(--border-radius); cursor: pointer; font-size: 1rem; font-weight: 500; transition: background-color var(--transition-speed) ease, transform 0.1s ease; margin: 0.5rem 0.5rem 0.5rem 0; display: inline-block; text-align: center; vertical-align: middle; }
        button:hover:not(:disabled), .button:hover { background-color: var(--secondary-accent); transform: translateY(-2px); box-shadow: 0 2px 5px var(--shadow-color); }
        button:active:not(:disabled), .button:active { transform: translateY(0px); }
        button:disabled { background-color: #bdc3c7; cursor: not-allowed; opacity: 0.7; }
        button.secondary { background-color: #7f8c8d; } button.secondary:hover:not(:disabled) { background-color: #95a5a6; }
        button.danger { background-color: var(--danger-accent); } button.danger:hover:not(:disabled) { background-color: var(--danger-accent-hover); }
        button.success { background-color: var(--success-accent); } button.success:hover:not(:disabled) { background-color: #27ae60; }
        textarea, input[type="text"], input[type="number"], input[type="date"], select { width: 100%; padding: 0.8rem; border: 1px solid var(--border-color); border-radius: var(--border-radius); margin-bottom: 1rem; font-family: inherit; font-size: 1rem; background-color: var(--bg-secondary); color: var(--text-primary); transition: border-color var(--transition-speed) ease, background-color var(--transition-speed) ease; }
        textarea:focus, input:focus, select:focus { outline: none; border-color: var(--primary-accent); box-shadow: 0 0 5px rgba(52, 152, 219, 0.5); }
        label { display: block; margin-bottom: 0.5rem; font-weight: bold; color: var(--text-secondary); }

        /* --- Logo Accueil --- */
        .home-logo { display: block; margin: 1.5rem auto 2rem auto; max-width: 180px; height: auto; border-radius: 50%; box-shadow: 0 3px 10px var(--shadow-color); }

        /* --- Listes Stylées --- */
        .styled-list li { background-color: var(--bg-primary); padding: 1rem 1.5rem; border: 1px solid var(--border-color); border-left: 5px solid var(--primary-accent); border-radius: var(--border-radius); margin-bottom: 0.8rem; position: relative; display: flex; justify-content: space-between; align-items: center; transition: background-color var(--transition-speed) ease, border-color var(--transition-speed) ease; word-wrap: break-word; overflow: hidden; }
        .list-item-content { flex-grow: 1; margin-right: 1rem; overflow: hidden; text-overflow: ellipsis; }
        .list-item-content strong { color: var(--primary-accent); }
        .list-item-content em { color: var(--text-secondary); font-size: 0.9em; }
        .list-item-actions button { padding: 0.3rem 0.6rem; font-size: 0.8rem; margin-left: 0.3rem; }
        .delete-btn { background-color: var(--danger-accent); min-width: 30px; }
        .delete-btn:hover { background-color: var(--danger-accent-hover); }
        .complete-btn { background-color: var(--success-accent); min-width: 30px; }
        .complete-btn:hover { background-color: #27ae60; }
        .styled-list li.completed { border-left-color: var(--success-accent); opacity: 0.7; }
        .styled-list li.completed .list-item-content { text-decoration: line-through; }

        /* --- Module Pression: Respiration --- */
        .breathing-controls { text-align: center; margin-bottom: 1.5rem; }
        .breathing-controls button { margin: 0.5rem; }
        #breathing-visualizer { width: 150px; height: 150px; background-color: var(--primary-accent); border-radius: 50%; margin: 2rem auto; display: flex; flex-direction: column; justify-content: center; align-items: center; color: white; font-size: 1rem; text-align: center; transition: transform 1.5s ease-in-out, background-color 1s ease; box-shadow: 0 0 20px rgba(52, 152, 219, 0.5); }
        #breathing-instruction { font-weight: bold; font-size: 1.1rem; margin-bottom: 0.3rem; }
        #breathing-timer { font-size: 1.8rem; font-weight: bold; color: var(--secondary-accent); margin-top: 1rem; text-align: center; }

        /* --- Module Concentration: Pomodoro --- */
        .pomodoro-explanation { background-color: var(--bg-primary); padding: 1rem; border-radius: var(--border-radius); margin-bottom: 1.5rem; border: 1px solid var(--border-color); font-size: 0.95rem; }
        #focus-timer-display { font-size: 4rem; font-weight: bold; text-align: center; margin: 1.5rem 0; color: var(--primary-accent); font-family: 'Courier New', Courier, monospace; }
        .timer-controls { text-align: center; margin-bottom: 1rem; }
        .timer-controls button { margin: 0.5rem; min-width: 120px; }
        #focus-status { text-align: center; margin-top: 1rem; font-style: italic; font-weight: bold; color: var(--secondary-accent); min-height: 1.5em; }

        /* --- Module Concentration: Jeu --- */
        #concentration-game-area { width: 100%; height: 300px; background-color: var(--bg-primary); border: 2px dashed var(--border-color); border-radius: var(--border-radius); margin-top: 1.5rem; position: relative; overflow: hidden; cursor: crosshair; }
        #game-target { width: 40px; height: 40px; background-color: var(--danger-accent); border-radius: 50%; position: absolute; cursor: pointer; display: none; transition: background-color 0.2s ease; box-shadow: 0 0 10px var(--danger-accent); }
        #game-target:hover { background-color: var(--danger-accent-hover); }
        #game-info { text-align: center; margin-top: 1rem; font-weight: bold; }

         /* --- Module Humeur --- */
         .mood-tracker { text-align: center; margin-bottom: 1.5rem; }
         .mood-options button { font-size: 1.5rem; padding: 0.5rem; background: none; border: 2px solid transparent; border-radius: 50%; margin: 0 0.5rem; transition: border-color var(--transition-speed); cursor:pointer; }
         .mood-options button:hover { transform: scale(1.1); }
         .mood-options button.selected { border-color: var(--primary-accent); box-shadow: 0 0 10px var(--primary-accent); }

        /* --- Diaporama Inspiration --- */
        #slideshow-container { position: relative; max-width: 700px; margin: 2rem auto; background-color: var(--slide-bg); border-radius: var(--border-radius); overflow: hidden; box-shadow: 0 5px 15px var(--shadow-color); min-height: 300px; display: flex; justify-content: center; align-items: center; }
        #slideshow-image { display: block; width: 100%; height: auto; max-height: 500px; object-fit: contain; border-radius: var(--border-radius); opacity: 0; transition: opacity 0.8s ease-in-out; }
        #slideshow-image.loaded { opacity: 1; }
        .slideshow-controls { text-align: center; margin-top: 1rem; }
        .slideshow-controls button { background-color: var(--secondary-accent); padding: 0.6rem 1.2rem; margin: 0 1rem; }
        .slideshow-controls button:hover { background-color: var(--primary-accent); }

        /* --- Theme Toggle --- */
        #theme-toggle { background: none; border: 1px solid var(--text-nav); color: var(--text-nav); padding: 0.4rem 0.8rem; font-size: 0.8rem; cursor: pointer; border-radius: var(--border-radius); transition: all var(--transition-speed) ease; margin-left: 1rem; }
        #theme-toggle:hover { background-color: var(--primary-accent); border-color: var(--primary-accent); color: white; }

        /* --- Utilitaires --- */
        .hidden { display: none; } .center-text { text-align: center; }
        .mt-1 { margin-top: 1rem; } .mt-2 { margin-top: 2rem; }
        .mb-1 { margin-bottom: 1rem; } .mb-2 { margin-bottom: 2rem; }

        /* --- Responsive Design --- */
        @media (max-width: 1024px) {
            .main-nav-list > li > button, .main-nav-list > li > a { padding: 0 0.8rem; font-size: 0.9rem; }
        }
        @media (max-width: 768px) {
             body { padding-top: var(--nav-height-mobile); }
             nav#top-nav { min-height: var(--nav-height-mobile); padding: 0 0.5rem; }
             .main-nav-list > li > button, .main-nav-list > li > a { padding: 0 0.6rem; font-size: 0.85rem; }
             .dropdown-menu { min-width: 180px; }
             .dropdown-menu li button.nav-btn { padding: 0.6rem 1rem; font-size: 0.85rem;}
             #theme-toggle { margin-left: 0.5rem; padding: 0.3rem 0.6rem; font-size: 0.8rem; }
             .container { padding: 1.5rem; margin: 1rem; }
             h1 { font-size: 1.8rem; } h2 { font-size: 1.4rem; }
             .styled-list li { flex-direction: column; align-items: flex-start; }
             .list-item-actions { margin-top: 0.5rem; width: 100%; text-align: right; }
             .list-item-content { margin-right: 0; }
        }
         @media (max-width: 480px) {
             .main-nav-list > li > button, .main-nav-list > li > a { padding: 0 0.4rem; font-size: 0.8rem; }
             /* Cache le texte des toggles de dropdown, garde icone + flèche */
             .dropdown-toggle span { display: none; }
             /* Ajuste si l'icone est une lettre ou un emoji */
             /* .dropdown-toggle::first-letter { margin-right: 0.2rem; } */

             button, .button { width: 100%; margin: 0.5rem 0; } /* Boutons pleine largeur */
             .timer-controls button { min-width: auto; }
             #focus-timer-display { font-size: 3rem; }
             #breathing-visualizer { width: 120px; height: 120px; }
             #slideshow-container { max-width: 100%; min-height: 200px;}
             .slideshow-controls button { margin: 0 0.5rem; }
         }
    </style>
</head>
<body data-theme="light">

    <!-- Navigation Principale avec Sous-Menus -->
    <nav id="top-nav">
        <ul class="main-nav-list">
            <li><button class="nav-btn" data-section="accueil">🏠 <span>Accueil</span></button></li>
            <li class="has-dropdown">
                <button class="dropdown-toggle">🧠 <span>Entraînement</span> ▼</button>
                <ul class="dropdown-menu">
                    <li><button class="nav-btn" data-section="pression">🧘 Pression</button></li>
                    <li><button class="nav-btn" data-section="visualisation">✨ Visualisation</button></li>
                    <li><button class="nav-btn" data-section="concentration">🎯 Concentration</button></li>
                    <li><button class="nav-btn" data-section="affirmations">➕ Affirmations</button></li>
                </ul>
            </li>
            <li class="has-dropdown">
                <button class="dropdown-toggle">📊 <span>Suivi</span> ▼</button>
                <ul class="dropdown-menu">
                    <li><button class="nav-btn" data-section="confiance">💪 Confiance</button></li>
                    <li><button class="nav-btn" data-section="resilience">🌱 Résilience</button></li>
                    <li><button class="nav-btn" data-section="objectifs">🏁 Objectifs</button></li>
                    <li><button class="nav-btn" data-section="humeur">😊 Humeur</button></li>
                    <li><button class="nav-btn" data-section="inspiration">🖼️ Inspiration</button></li>
                </ul>
            </li>
            <li class="has-dropdown">
                 <button class="dropdown-toggle">⚙️ <span>Options</span> ▼</button>
                <ul class="dropdown-menu">
                    <li><button class="nav-btn" data-section="aide">❓ Aide</button></li>
                    <li><button class="nav-btn" data-section="parametres">🔧 Paramètres</button>
                </ul>
            </li>
        </ul>
        <button id="theme-toggle">☀️ / 🌙</button>
    </nav>

    <main class="container">
        <h1 id="main-title">Accueil</h1>

        <!-- ========== Section Accueil ========== -->
        <section id="section-accueil" class="section active">
            <img src="logo.png" alt="Logo Coach Mental Awalé" class="home-logo">
            <h2>Bienvenue sur votre Coach Mental Awalé Pro !</h2>
            <p>Cette application est votre partenaire pour aiguiser votre esprit et aborder vos compétitions d'Awalé avec sérénité et détermination.</p>
            <p>Explorez les différentes sections via le menu ci-dessus :</p>
            <ul>
                 <li>🧠 <strong>Entraînement :</strong> Pression, Visualisation, Concentration, Affirmations.</li>
                 <li>📊 <strong>Suivi :</strong> Confiance, Résilience, Objectifs, Humeur, Inspiration.</li>
                 <li>⚙️ <strong>Options :</strong> Aide, Paramètres.</li>
            </ul>
            <hr class="mt-2 mb-2">
            <h3>Pensée du Jour :</h3>
            <blockquote id="quote-display" style="font-style: italic; border-left: 3px solid var(--primary-accent); padding-left: 1rem;">Chargement...</blockquote>
        </section>

        <!-- ========== Section Pression ========== -->
        <section id="section-pression" class="section">
            <h2>🧘 Gestion de la Pression</h2>
            <p>Maîtrisez votre calme intérieur grâce à la respiration.</p>
            <h3>Respiration Guidée</h3>
            <p>Choisissez un exercice pour recentrer votre attention et calmer votre système nerveux. Cliquez sur un bouton pour démarrer.</p>
            <div class="breathing-controls">
                <button id="btn-breath-box" class="secondary">Carrée (4-4-4-4)</button>
                <button id="btn-breath-478" class="secondary">Relaxante (4-7-8)</button>
                <button id="btn-breath-stop" class="danger" disabled>Arrêter</button>
            </div>
            <div id="breathing-visualizer"><span id="breathing-instruction">Prêt ?</span></div>
            <div id="breathing-timer">00:00</div>
        </section>

        <!-- ========== Section Visualisation ========== -->
        <section id="section-visualisation" class="section">
            <h2>✨ Visualisation Positive</h2>
             <p>Créez ou chargez un scénario mental de succès pour renforcer votre confiance et préparer votre esprit à la victoire.</p>
             <label for="visualization-text">Mon Scénario :</label>
             <textarea id="visualization-text" rows="10" placeholder="Décrivez une partie idéale : votre calme, votre concentration, vos bons coups, le sentiment de maîtrise et de succès... Soyez précis sur les sensations, les émotions ressenties."></textarea>
             <button id="btn-save-visualization" class="success">💾 Sauvegarder</button>
             <button id="btn-load-visualization">🔄 Charger</button>
             <p class="mt-2" style="font-size: 0.9em; font-style: italic;">Conseil : Pratiquez la visualisation régulièrement, dans un endroit calme, en vous immergeant complètement dans le scénario.</p>
        </section>

        <!-- ========== Section Confiance ========== -->
        <section id="section-confiance" class="section">
            <h2>💪 Confiance en Soi</h2>
             <p>Nourrissez votre confiance en reconnaissant vos accomplissements et vos qualités.</p>
             <h3>Journal des Succès</h3>
             <p>Chaque victoire, même petite, compte. Notez-les ici.</p>
             <label for="success-entry">Nouveau Succès / Bon coup / Fierté :</label>
             <textarea id="success-entry" rows="3" placeholder="Ex: J'ai bien défendu une case faible contre M... / J'ai gardé mon calme après une erreur..."></textarea>
             <button id="btn-add-success" class="success">➕ Ajouter au Journal</button>
             <h4 class="mt-1">Mes Succès Enregistrés :</h4>
             <ul id="success-list" class="styled-list">Chargement...</ul>
             <hr class="mt-2 mb-2">
             <h3>Inventaire de Mes Forces</h3>
             <p>Identifiez et rappelez-vous de vos atouts spécifiques à l'Awalé.</p>
             <label for="strength-entry">Ajouter une Force :</label>
             <textarea id="strength-entry" rows="3" placeholder="Ex: Calcul rapide des Krou, vision à long terme, gestion du temps..."></textarea>
             <button id="btn-add-strength" class="success">➕ Ajouter une Force</button>
             <h4 class="mt-1">Mes Forces Identifiées :</h4>
             <ul id="strength-list" class="styled-list">Chargement...</ul>
        </section>

        <!-- ========== Section Résilience ========== -->
        <section id="section-resilience" class="section">
            <h2>🌱 Résilience</h2>
             <p>Apprenez de chaque partie, surtout des défaites, pour revenir plus fort.</p>
             <h3>Analyse Constructive Post-Partie</h3>
             <p>Utilisez ce formulaire pour analyser une partie (gagnée ou perdue) de manière objective.</p>
             <form id="defeat-analysis-form">
                 <label for="analysis-date">Date de la partie :</label> <input type="date" id="analysis-date" required>
                 <label for="analysis-opponent">Adversaire / Contexte :</label> <input type="text" id="analysis-opponent" placeholder="Ex: Tournoi Y, Partie 3 vs Z / Entraînement">
                 <label for="analysis-result">Résultat (Optionnel) :</label> <input type="text" id="analysis-result" placeholder="Ex: Victoire, Défaite, Nulle / Score">
                 <label for="analysis-positive">✅ Points Positifs / Ce qui a bien fonctionné :</label> <textarea id="analysis-positive" rows="3"></textarea>
                 <label for="analysis-keymoment">🔑 Moment(s) Clé(s) / Point(s) à améliorer :</label> <textarea id="analysis-keymoment" rows="3"></textarea>
                 <label for="analysis-learning">💡 Principal Apprentissage / Leçon Retenue :</label> <textarea id="analysis-learning" rows="3"></textarea>
                 <label for="analysis-next">🚀 Actions Concrètes pour la Prochaine Fois :</label> <textarea id="analysis-next" rows="3"></textarea>
                <button type="submit" class="success">💾 Sauvegarder l'Analyse</button> <button type="reset" class="secondary">Effacer le Formulaire</button>
            </form>
            <h4 class="mt-2">Mes Analyses Précédentes :</h4>
            <ul id="analysis-list" class="styled-list">Chargement...</ul>
        </section>

        <!-- ========== Section Concentration ========== -->
        <section id="section-concentration" class="section">
            <h2>🎯 Concentration & Endurance Mentale</h2>
             <p>Entraînez votre capacité à rester focalisé pendant de longues périodes.</p>
             <h3>Minuteur de Focus (Technique Pomodoro)</h3>
             <div class="pomodoro-explanation"><p><strong>Comment ça marche ?</strong> La technique Pomodoro aide à maintenir une concentration élevée...</p><ol><li>Choisissez une tâche...</li><li>Lancez le minuteur...</li><li>Travaillez intensément...</li><li>Prenez une pause courte...</li><li>Prenez une pause longue...</ol><p>Utilisez les boutons ci-dessous...</p></div>
             <div id="focus-timer-display">25:00</div>
             <div class="timer-controls"> <button id="btn-focus-start" title="Démarrer une session de travail de 25 min">💼 Travail (25m)</button> <button id="btn-focus-pause" title="Mettre en pause ou reprendre le minuteur">⏯️ Pause/Rep.</button> <button id="btn-focus-reset" class="secondary" title="Réinitialiser le minuteur à 25 min">🔄 Reset</button> <br> <button id="btn-focus-short-break" class="success" title="Démarrer une pause courte de 5 min">☕ Pause (5m)</button> <button id="btn-focus-long-break" class="success" title="Démarrer une pause longue de 15 min">🚶 Pause (15m)</button> </div>
             <div id="focus-status">Prêt à démarrer une session de travail.</div>
             <hr class="mt-2 mb-2">
             <h3>Mini-Jeu de Concentration : Cible Rapide</h3>
             <p>Testez et améliorez votre vitesse de réaction et votre focus visuel. Cliquez sur la cible rouge dès qu'elle apparaît !</p>
             <button id="btn-start-game" class="secondary">🚀 Lancer le Jeu (10 cibles)</button>
             <div id="concentration-game-area"><div id="game-target"></div></div>
             <div id="game-info">Score : 0 | Temps moyen : N/A ms</div>
        </section>

        <!-- ========== Section Objectifs ========== -->
        <section id="section-objectifs" class="section">
            <h2>🏁 Objectifs Mentaux</h2>
             <p>Définissez des objectifs clairs pour votre préparation mentale.</p>
             <label for="goal-entry">Nouvel Objectif :</label>
            <textarea id="goal-entry" rows="3" placeholder="Ex: Méditer 5 min avant chaque session d'entraînement / Analyser 3 de mes défaites cette semaine / Rester positif même si je perds des graines en début de partie..."></textarea>
            <button id="btn-add-goal" class="success">➕ Ajouter l'Objectif</button>
             <h4 class="mt-1">Mes Objectifs Actuels :</h4>
            <ul id="goal-list" class="styled-list">Chargement...</ul>
        </section>

        <!-- ========== Section Affirmations ========== -->
        <section id="section-affirmations" class="section">
            <h2>➕ Affirmations Positives</h2>
             <p>Répétez ces phrases pour cultiver un état d'esprit fort et positif.</p>
            <div id="affirmation-display" style="font-size: 1.4rem; font-style: italic; text-align: center; margin: 2rem 0; padding: 1rem; border: 1px solid var(--border-color); border-radius: var(--border-radius); background-color: var(--bg-primary);">Chargement...</div>
            <div class="center-text"><button id="btn-next-affirmation">🔄 Autre Affirmation</button></div>
            <hr class="mt-2 mb-2">
            <h3>Mes Affirmations Personnalisées</h3>
             <label for="affirmation-entry">Ajouter une affirmation personnelle :</label>
            <textarea id="affirmation-entry" rows="2" placeholder="Ex: Je suis capable de calculs complexes / Chaque partie m'apprend quelque chose..."></textarea>
            <button id="btn-add-affirmation" class="success">➕ Ajouter</button>
            <h4 class="mt-1">Mes Affirmations :</h4>
            <ul id="affirmation-list" class="styled-list">Chargement...</ul>
        </section>

        <!-- ========== Section Inspiration ========== -->
        <section id="section-inspiration" class="section">
            <h2>🖼️ Inspiration Visuelle</h2>
            <p>Laissez ces images nourrir votre motivation et votre état d'esprit de champion.</p>
            <div id="slideshow-container"><img id="slideshow-image" src="" alt="Image inspirante"></div>
            <div class="slideshow-controls"> <button id="slideshow-prev">⬅️ Précédent</button> <button id="slideshow-next">Suivant ➡️</button> </div>
            <p id="slideshow-caption" class="center-text mt-1" style="font-style: italic; color: var(--text-secondary);"></p>
        </section>

        <!-- ========== Section Humeur ========== -->
        <section id="section-humeur" class="section">
             <h2>😊 Suivi d'Humeur & Focus</h2>
             <p>Prenez un instant pour évaluer votre état mental avant ou après une session.</p>
             <div class="mood-tracker">
                 <label>Comment vous sentez-vous maintenant ? (Focus / Énergie)</label>
                 <div class="mood-options mb-1"> <button data-mood="1" title="Très faible">😩</button> <button data-mood="2" title="Faible">😟</button> <button data-mood="3" title="Moyen">😐</button> <button data-mood="4" title="Bon">🙂</button> <button data-mood="5" title="Excellent">😃</button> </div>
                 <label for="mood-note">Note rapide (optionnel) :</label> <input type="text" id="mood-note" placeholder="Ex: Fatigué après entraînement / Prêt pour la partie !">
                 <button id="btn-save-mood" class="success">💾 Enregistrer l'Humeur</button>
             </div>
             <h4 class="mt-2">Historique d'Humeur :</h4>
             <ul id="mood-history-list" class="styled-list">Chargement...</ul>
        </section>

        <!-- ========== Section Aide ========== -->
        <section id="section-aide" class="section">
            <h2>❓ Aide & Informations</h2>
            <p>Comprendre les outils de votre Coach Mental.</p>
             <article class="mb-2"><h3>🧠 Entraînement</h3> <p><strong>Pression :</strong> Respiration guidée...</p> <p><strong>Visualisation :</strong> Créez des scénarios de succès...</p><p><strong>Concentration :</strong> Utilisez Pomodoro, jouez au jeu de cible...</p><p><strong>Affirmations :</strong> Renforcez votre mental avec des phrases positives...</p></article>
             <article class="mb-2"><h3>📊 Suivi</h3> <p><strong>Confiance :</strong> Notez succès et forces...</p> <p><strong>Résilience :</strong> Analysez vos parties...</p><p><strong>Objectifs :</strong> Définissez des buts clairs...</p><p><strong>Humeur :</strong> Suivez votre état d'esprit...</p><p><strong>Inspiration :</strong> Trouvez la motivation visuelle...</p></article>
             <article><h3>⚙️ Options</h3> <p><strong>Aide :</strong> Vous êtes ici !</p> <p><strong>Paramètres :</strong> Changez le thème, gérez vos données (export, import, suppression)...</p></article>
        </section>

         <!-- ========== Section Paramètres ========== -->
        <section id="section-parametres" class="section">
            <h2>🔧 Paramètres & Données</h2>
             <h3>Thème de l'Application</h3> <p>Choisissez votre apparence préférée.</p>
             <button id="btn-set-light-theme">☀️ Clair</button> <button id="btn-set-dark-theme">🌙 Sombre</button>
             <hr class="mt-2 mb-2">
            <h3>Gestion des Données Utilisateur</h3> <p>Vos données (succès, analyses, etc.) sont stockées <strong>uniquement dans votre navigateur</strong> sur cet appareil.</p> <p>⚠️ Vider le cache de votre navigateur ou utiliser un autre appareil effacera vos données enregistrées. Utilisez Export/Import pour sauvegarder.</p>
            <div style="margin-top: 1.5rem;"> <button id="btn-export-data" class="secondary">📤 Exporter mes Données</button> <label for="import-file-input" class="button secondary mt-1" style="cursor: pointer;">📥 Importer des Données</label> <input type="file" id="import-file-input" accept=".json" style="display: none;"> <p id="import-status" style="font-size: 0.9em; margin-top: 0.5em;"></p> </div>
            <div style="margin-top: 2rem; border: 2px solid var(--danger-accent); padding: 1rem; border-radius: var(--border-radius);"> <h4 style="color: var(--danger-accent);">Zone Dangereuse</h4> <p>Cette action est irréversible et supprimera toutes vos données enregistrées dans cette application.</p> <button id="btn-delete-all-data" class="danger">🗑️ Supprimer Toutes Mes Données</button> </div>
        </section>

    </main> <!-- Fin .container -->

    <script>
        // ========================================================================
        //                             JAVASCRIPT COMPLET
        // ========================================================================
        document.addEventListener('DOMContentLoaded', () => {
            console.log("DEBUG: DOM Loaded, starting script execution...");

            // --- Configuration ---
            const POMODORO_DEFAULTS = { work: 25 * 60, shortBreak: 5 * 60, longBreak: 15 * 60 };
            const DEFAULT_AFFIRMATIONS = [
                "Je suis calme et concentré(e) sous pression.", "Chaque partie est une opportunité d'apprendre.",
                "Je fais confiance à mon intuition et à mon calcul.", "Je suis capable de surmonter les défis.",
                "Ma préparation mentale me donne un avantage.", "J'aborde chaque coup avec clarté.",
                "Je suis résilient(e) face aux erreurs et aux défaites.", "Je visualise mon succès.",
                "Mon esprit est mon meilleur atout.", "Je joue avec plaisir et détermination."
            ];
            const MOOD_EMOJIS = { 1: '😩', 2: '😟', 3: '😐', 4: '🙂', 5: '😃' };
            // !!! IMPORTANT : METTEZ À JOUR AVEC VOS NOMS DE FICHIERS EXACTS !!!
            const inspirationalImages = [
                 'photos/image1.jpg',
                 'photos/image2.jpg', // Vérifie l'extension (.jpg, .png, etc.)
                 'photos/image3.jpg',
                 'photos/image4.jpg'
                 // Ajoute d'autres chemins si nécessaire: 'photos/nom_fichier.ext'
            ];

            // --- DOM Elements ---
            console.log("DEBUG: Selecting DOM elements...");
            const body = document.body;
            const allNavButtons = document.querySelectorAll('.nav-btn[data-section]'); // Boutons finaux pour navigation
            const sections = document.querySelectorAll('.section');
            const mainTitle = document.getElementById('main-title');
            const themeToggle = document.getElementById('theme-toggle');
            const dropdownToggles = document.querySelectorAll('.dropdown-toggle');
            const dropdownParents = document.querySelectorAll('.has-dropdown');
            const quoteDisplay = document.getElementById('quote-display');
            const btnSetLightTheme = document.getElementById('btn-set-light-theme');
            const btnSetDarkTheme = document.getElementById('btn-set-dark-theme');
            // Pression
            const btnBreathBox = document.getElementById('btn-breath-box');
            const btnBreath478 = document.getElementById('btn-breath-478');
            const btnBreathStop = document.getElementById('btn-breath-stop');
            const visualizer = document.getElementById('breathing-visualizer');
            const breathTimerDisplay = document.getElementById('breathing-timer');
            const breathInstruction = document.getElementById('breathing-instruction');
            // Visualisation
            const visualizationText = document.getElementById('visualization-text');
            const btnSaveVisualization = document.getElementById('btn-save-visualization');
            const btnLoadVisualization = document.getElementById('btn-load-visualization');
            // Confiance
            const successEntry = document.getElementById('success-entry');
            const btnAddSuccess = document.getElementById('btn-add-success');
            const successList = document.getElementById('success-list');
            const strengthEntry = document.getElementById('strength-entry');
            const btnAddStrength = document.getElementById('btn-add-strength');
            const strengthList = document.getElementById('strength-list');
            // Résilience
            const defeatForm = document.getElementById('defeat-analysis-form');
            const analysisList = document.getElementById('analysis-list');
            const analysisDate = document.getElementById('analysis-date');
            const analysisOpponent = document.getElementById('analysis-opponent');
            const analysisResult = document.getElementById('analysis-result');
            const analysisPositive = document.getElementById('analysis-positive');
            const analysisKeyMoment = document.getElementById('analysis-keymoment');
            const analysisLearning = document.getElementById('analysis-learning');
            const analysisNext = document.getElementById('analysis-next');
            // Concentration
            const focusTimerDisplay = document.getElementById('focus-timer-display');
            const btnFocusStart = document.getElementById('btn-focus-start');
            const btnFocusPause = document.getElementById('btn-focus-pause');
            const btnFocusReset = document.getElementById('btn-focus-reset');
            const btnFocusShortBreak = document.getElementById('btn-focus-short-break');
            const btnFocusLongBreak = document.getElementById('btn-focus-long-break');
            const focusStatus = document.getElementById('focus-status');
            const btnStartGame = document.getElementById('btn-start-game');
            const gameArea = document.getElementById('concentration-game-area');
            const gameTarget = document.getElementById('game-target');
            const gameInfo = document.getElementById('game-info');
            // Objectifs
            const goalEntry = document.getElementById('goal-entry');
            const btnAddGoal = document.getElementById('btn-add-goal');
            const goalList = document.getElementById('goal-list');
            // Affirmations
            const affirmationDisplay = document.getElementById('affirmation-display');
            const btnNextAffirmation = document.getElementById('btn-next-affirmation');
            const affirmationEntry = document.getElementById('affirmation-entry');
            const btnAddAffirmation = document.getElementById('btn-add-affirmation');
            const affirmationList = document.getElementById('affirmation-list');
            // Inspiration
            const slideshowImage = document.getElementById('slideshow-image');
            const btnSlideshowPrev = document.getElementById('slideshow-prev');
            const btnSlideshowNext = document.getElementById('slideshow-next');
            const slideshowCaption = document.getElementById('slideshow-caption');
            // Humeur
            const moodOptionsContainer = document.querySelector('.mood-options');
            const moodNote = document.getElementById('mood-note');
            const btnSaveMood = document.getElementById('btn-save-mood');
            const moodHistoryList = document.getElementById('mood-history-list');
            // Paramètres
            const btnExportData = document.getElementById('btn-export-data');
            const importFileInput = document.getElementById('import-file-input');
            const importStatus = document.getElementById('import-status');
            const btnDeleteAllData = document.getElementById('btn-delete-all-data');
            console.log(`DEBUG: Found ${allNavButtons.length} final navigation buttons.`);
            console.log(`DEBUG: Found ${dropdownToggles.length} dropdown toggle buttons.`);
            console.log(`DEBUG: Found ${dropdownParents.length} dropdown parent LIs.`);
            console.log("DEBUG: DOM element selection finished.");

            // --- State Variables ---
            let breathInterval = null, breathTotalSeconds = 0, breathCycle = [], breathCurrentPhaseIndex = 0, breathPhaseTimer = 0;
            let focusInterval = null, focusTotalSeconds = POMODORO_DEFAULTS.work, focusIsRunning = false, focusCurrentMode = 'Travail';
            let gameScore = 0, gameTargetCount = 0, gameStartTime = 0, gameReactionTimes = [], gameTimeoutId = null;
            let selectedMood = null;
            let currentSlideIndex = 0;
            let isSlideshowLoading = false;

            // --- Local Storage Keys ---
            const STORAGE_KEYS = {
                THEME: 'awale_mental_theme', VISUALIZATION: 'awale_mental_visualization',
                SUCCESSES: 'awale_mental_successes', STRENGTHS: 'awale_mental_strengths',
                ANALYSES: 'awale_mental_analyses', GOALS: 'awale_mental_goals',
                AFFIRMATIONS: 'awale_mental_affirmations', MOOD_HISTORY: 'awale_mental_mood_history',
                ALL_DATA: 'awale_mental_all_data' // Used for export/import grouping
            };

            // --- Helper Functions ---
            function saveData(key, data) { try { localStorage.setItem(key, JSON.stringify(data)); } catch (e) { console.error("LocalStorage Save Error for key " + key + ":", e); alert("Erreur lors de la sauvegarde des données. Le stockage est peut-être plein ou indisponible."); } }
            function loadData(key, defaultValue = []) { try { const data = localStorage.getItem(key); return data ? JSON.parse(data) : defaultValue; } catch (e) { console.error("LocalStorage Load Error for key " + key + ":", e); return defaultValue; } }
            function formatTime(seconds) { const mins = Math.floor(seconds / 60); const secs = seconds % 60; return `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`; }

            function renderStyledList(data, listElement, renderItemFn, storageKey, options = {}) {
                if (!listElement) { console.warn(`List element null or undefined for key ${storageKey}`); return; }
                listElement.innerHTML = '';
                if (!data || data.length === 0) { listElement.innerHTML = '<li>Aucun élément à afficher.</li>'; return; }

                data.forEach((item, index) => {
                    const li = document.createElement('li');
                    if (options.itemClass) li.classList.add(options.itemClass);
                    if (item && item.completed && options.completable) li.classList.add('completed');

                    const contentDiv = document.createElement('div');
                    contentDiv.classList.add('list-item-content');
                    try { contentDiv.innerHTML = renderItemFn(item); } catch(e) { console.error("Error rendering list item:", item, e); contentDiv.textContent = "Erreur rendu item"; }
                    li.appendChild(contentDiv);

                    const actionsDiv = document.createElement('div');
                    actionsDiv.classList.add('list-item-actions');
                    if (options.completable) {
                        const completeBtn = document.createElement('button');
                        completeBtn.textContent = item && item.completed ? '✅' : '⬜';
                        completeBtn.title = item && item.completed ? "Marquer comme non terminé" : "Marquer comme terminé";
                        completeBtn.classList.add('complete-btn', 'secondary');
                        completeBtn.onclick = () => {
                            if (item) item.completed = !item.completed;
                            saveData(storageKey, data);
                            renderStyledList(data, listElement, renderItemFn, storageKey, options);
                        };
                        actionsDiv.appendChild(completeBtn);
                    }
                    if (options.deletable !== false) {
                        const deleteBtn = document.createElement('button');
                        deleteBtn.textContent = '❌';
                        deleteBtn.title = "Supprimer cet élément";
                        deleteBtn.classList.add('delete-btn', 'danger');
                        deleteBtn.onclick = () => {
                            if (confirm('Voulez-vous vraiment supprimer cet élément ?')) {
                                data.splice(index, 1);
                                saveData(storageKey, data);
                                renderStyledList(data, listElement, renderItemFn, storageKey, options);
                            }
                        };
                        actionsDiv.appendChild(deleteBtn);
                    }
                    li.appendChild(actionsDiv);
                    listElement.appendChild(li);
                });
            }

            // --- Dropdown Menu Logic ---
            function closeAllDropdowns(exceptThisParent = null) {
                 dropdownParents.forEach(parentLi => {
                     if (parentLi !== exceptThisParent) { parentLi.classList.remove('active'); }
                 });
            }

             console.log("DEBUG: Attaching dropdown toggle listeners...");
             if (dropdownToggles.length > 0) {
                dropdownToggles.forEach((toggle, index) => {
                    console.log(`DEBUG: Attaching listener to toggle ${index}:`, toggle);
                    toggle.addEventListener('click', (event) => {
                        console.log(`---------- DEBUG: Dropdown Toggle ${index} CLICKED ----------`);
                        event.stopPropagation();
                        const parentLi = toggle.closest('.has-dropdown');
                        if (!parentLi) { console.error("DEBUG: COULD NOT FIND parent '.has-dropdown' for toggle:", toggle); return; }
                        const isActive = parentLi.classList.contains('active');
                        console.log(`DEBUG: Found parent Li. Was active: ${isActive}`);
                        closeAllDropdowns(parentLi); // Ferme les autres d'abord
                        parentLi.classList.toggle('active');
                        console.log(`DEBUG: Parent Li 'active' state AFTER toggle: ${parentLi.classList.contains('active')}`);
                        console.log(`-----------------------------------------------------------`);
                    });
                });
             } else { console.error("DEBUG: !!! NO DROPDOWN TOGGLE BUTTONS FOUND !!!"); }
             console.log("DEBUG: Dropdown toggle listeners attachment finished.");

             console.log("DEBUG: Attaching document click listener to close dropdowns...");
             document.addEventListener('click', (event) => {
                  if (!event.target.closest('.has-dropdown')) { closeAllDropdowns(); }
             });
             console.log("DEBUG: Document click listener attached.");


            // --- Navigation Logic ---
            function setActiveSection(sectionId) {
                console.log(`DEBUG: setActiveSection called with ID: ${sectionId}`);
                 let sectionActivated = false;
                 let targetButtonText = sectionId; // Default title
                 sections.forEach(section => {
                     const isActive = section.id === `section-${sectionId}`;
                     section.classList.toggle('active', isActive);
                      if(isActive) sectionActivated = true;
                 });

                 if (!sectionActivated) {
                      console.warn(`DEBUG: Section 'section-${sectionId}' not found! Falling back to accueil.`);
                      setActiveSection('accueil'); return;
                 }

                 // Update Main Title H1 and Active Button State
                 allNavButtons.forEach(button => {
                     const buttonSection = button.dataset.section;
                      const shouldBeActive = (buttonSection === sectionId);
                     button.classList.toggle('active', shouldBeActive);
                      if(shouldBeActive) {
                           // Try to get text content excluding potential initial icon/emoji
                           targetButtonText = button.textContent.replace(/^[^\w]+/, '').trim();
                      }
                 });
                  mainTitle.textContent = targetButtonText; // Update H1

                  // Mark parent dropdown toggle as active if a child is active (visual aid) - OPTIONAL
                   dropdownParents.forEach(li => li.classList.remove('parent-active')); // Clear previous
                   const activeNavButton = document.querySelector('.nav-btn[data-section].active');
                   if(activeNavButton) {
                        const parentLi = activeNavButton.closest('.has-dropdown');
                        if(parentLi) {
                             parentLi.classList.add('parent-active'); // Add a class to style the parent toggle if needed
                             // Example CSS: .main-nav-list > li.parent-active > button { color: var(--text-nav-active); }
                        }
                   }


                 closeAllDropdowns(); // Ferme menus après nav
                 window.scrollTo(0, 0);
            }

             console.log("DEBUG: Attaching navigation listeners to final nav-btn elements...");
             if (allNavButtons.length > 0) {
                allNavButtons.forEach(button => {
                    const targetSection = button.dataset.section;
                    if (!targetSection) return;
                    button.addEventListener('click', (event) => {
                        event.stopPropagation();
                        console.log(`DEBUG: Click detected on nav button: ${targetSection}`);
                        setActiveSection(targetSection);
                    });
                });
             } else { console.error("DEBUG: !!! NO FINAL NAVIGATION BUTTONS FOUND !!!"); }
             console.log("DEBUG: Navigation listeners attachment finished.");


            // --- Theme Management Logic ---
            function applyTheme(theme) {
                body.dataset.theme = theme;
                saveData(STORAGE_KEYS.THEME, theme);
                 if(themeToggle) themeToggle.textContent = theme === 'light' ? '🌙 Sombre' : '☀️ Clair';
            }
             if(themeToggle) {
                themeToggle.addEventListener('click', () => {
                    const currentTheme = body.dataset.theme || 'light';
                    applyTheme(currentTheme === 'light' ? 'dark' : 'light');
                });
             }
             if(btnSetLightTheme) btnSetLightTheme.addEventListener('click', () => applyTheme('light'));
             if(btnSetDarkTheme) btnSetDarkTheme.addEventListener('click', () => applyTheme('dark'));

            // --- Respiration Logic ---
            function stopBreathingExercise() {
                clearInterval(breathInterval); breathInterval = null;
                if(visualizer) { visualizer.style.transform = 'scale(1)'; visualizer.style.backgroundColor = 'var(--primary-accent)'; }
                if(breathInstruction) breathInstruction.textContent = 'Prêt ?';
                if(breathTimerDisplay) breathTimerDisplay.textContent = '00:00';
                if(btnBreathBox) btnBreathBox.disabled = false;
                if(btnBreath478) btnBreath478.disabled = false;
                if(btnBreathStop) btnBreathStop.disabled = true;
            }
            function updateBreathVisuals(phase) {
                 if(breathInstruction) breathInstruction.textContent = `${phase.action} (${phase.duration}s)`;
                 if(visualizer) { visualizer.style.backgroundColor = `var(--${phase.color || 'primary-accent'})`; visualizer.style.transform = `scale(${phase.scale || 1})`; }
            }
            function updateBreathTimer() {
                 breathTotalSeconds++;
                 if(breathTimerDisplay) breathTimerDisplay.textContent = formatTime(breathTotalSeconds);
                 if (breathCycle.length > 0) {
                     breathPhaseTimer--;
                     if (breathPhaseTimer <= 0) {
                         breathCurrentPhaseIndex = (breathCurrentPhaseIndex + 1) % breathCycle.length;
                         const currentPhase = breathCycle[breathCurrentPhaseIndex];
                         breathPhaseTimer = currentPhase.duration;
                         updateBreathVisuals(currentPhase);
                     }
                 }
            }
            function startBreathingExercise(cycle) {
                stopBreathingExercise(); breathCycle = cycle; breathCurrentPhaseIndex = -1; breathPhaseTimer = 1; breathTotalSeconds = -1;
                if(btnBreathBox) btnBreathBox.disabled = true; if(btnBreath478) btnBreath478.disabled = true; if(btnBreathStop) btnBreathStop.disabled = false;
                updateBreathTimer(); breathInterval = setInterval(updateBreathTimer, 1000);
            }
            if(btnBreathBox) btnBreathBox.addEventListener('click', () => startBreathingExercise([ { action: 'Inspirez', duration: 4, scale: 1.2, color: 'success-accent' }, { action: 'Retenez', duration: 4, scale: 1.2, color: 'warning-accent' }, { action: 'Expirez', duration: 4, scale: 0.8, color: 'secondary-accent' }, { action: 'Retenez', duration: 4, scale: 0.8, color: 'warning-accent' } ]));
            if(btnBreath478) btnBreath478.addEventListener('click', () => startBreathingExercise([ { action: 'Inspirez', duration: 4, scale: 1.2, color: 'success-accent' }, { action: 'Retenez', duration: 7, scale: 1.2, color: 'warning-accent' }, { action: 'Expirez', duration: 8, scale: 0.8, color: 'secondary-accent' } ]));
            if(btnBreathStop) btnBreathStop.addEventListener('click', stopBreathingExercise);

             // --- Visualisation Logic ---
             if(btnSaveVisualization) btnSaveVisualization.addEventListener('click', () => { if(visualizationText) { saveData(STORAGE_KEYS.VISUALIZATION, visualizationText.value); alert('Visualisation sauvegardée !'); } });
             if(btnLoadVisualization) btnLoadVisualization.addEventListener('click', () => { if(visualizationText) { const loadedText = loadData(STORAGE_KEYS.VISUALIZATION, ''); visualizationText.value = loadedText; if(!loadedText) alert('Aucune visualisation sauvegardée.'); } });

            // --- Confiance Logic ---
            function renderSuccessItem(item) { return typeof item === 'string' ? item : 'Erreur: donnée invalide'; }
            function loadAndRenderSuccesses() { const d = loadData(STORAGE_KEYS.SUCCESSES, []); if(successList) renderStyledList(d, successList, renderSuccessItem, STORAGE_KEYS.SUCCESSES, { deletable: true }); }
            if(btnAddSuccess) btnAddSuccess.addEventListener('click', () => { if(successEntry) { const entry = successEntry.value.trim(); if (entry) { const d = loadData(STORAGE_KEYS.SUCCESSES, []); d.unshift(entry); saveData(STORAGE_KEYS.SUCCESSES, d); loadAndRenderSuccesses(); successEntry.value = ''; } else { alert('Veuillez entrer un succès.'); }} });
            function renderStrengthItem(item) { return typeof item === 'string' ? item : 'Erreur: donnée invalide'; }
            function loadAndRenderStrengths() { const d = loadData(STORAGE_KEYS.STRENGTHS, []); if(strengthList) renderStyledList(d, strengthList, renderStrengthItem, STORAGE_KEYS.STRENGTHS, { deletable: true }); }
            if(btnAddStrength) btnAddStrength.addEventListener('click', () => { if(strengthEntry) { const entry = strengthEntry.value.trim(); if (entry) { const d = loadData(STORAGE_KEYS.STRENGTHS, []); d.unshift(entry); saveData(STORAGE_KEYS.STRENGTHS, d); loadAndRenderStrengths(); strengthEntry.value = ''; } else { alert('Veuillez entrer une force.'); }} });

            // --- Résilience Logic ---
            function renderAnalysisItem(item) { if (!item) return "Erreur: item null"; const date = item.date ? new Date(item.date).toLocaleDateString('fr-FR', { day: '2-digit', month: 'short', year: 'numeric' }) : '?'; return `<strong>${item.opponent || 'Analyse'} (${date})</strong> ${item.result ? ' - '+item.result : ''}<br><em>Appris : ${item.learning || 'Non spécifié'}</em>`; }
            function loadAndRenderAnalyses() { const d = loadData(STORAGE_KEYS.ANALYSES, []); if(analysisList) renderStyledList(d.sort((a,b) => new Date(b.date) - new Date(a.date)), analysisList, renderAnalysisItem, STORAGE_KEYS.ANALYSES, { deletable: true }); }
            if(defeatForm) defeatForm.addEventListener('submit', (e) => { e.preventDefault(); if (!analysisDate || !analysisDate.value) { alert("Veuillez sélectionner une date."); return; } const analysisData = { id: Date.now(), date: analysisDate.value, opponent: analysisOpponent?.value.trim() || '', result: analysisResult?.value.trim() || '', positive: analysisPositive?.value.trim() || '', keyMoment: analysisKeyMoment?.value.trim() || '', learning: analysisLearning?.value.trim() || '', nextSteps: analysisNext?.value.trim() || '' }; const analyses = loadData(STORAGE_KEYS.ANALYSES, []); analyses.push(analysisData); saveData(STORAGE_KEYS.ANALYSES, analyses); loadAndRenderAnalyses(); defeatForm.reset(); analysisDate.valueAsDate = new Date(); alert("Analyse sauvegardée !"); });

            // --- Concentration: Pomodoro Logic ---
             function enableFocusStartButtons() { if(btnFocusStart) btnFocusStart.disabled = false; if(btnFocusShortBreak) btnFocusShortBreak.disabled = false; if(btnFocusLongBreak) btnFocusLongBreak.disabled = false; if(btnFocusPause) { btnFocusPause.textContent = '⏯️ Pause/Rep.'; btnFocusPause.disabled = true; } }
             function disableFocusStartButtons() { if(btnFocusStart) btnFocusStart.disabled = true; if(btnFocusShortBreak) btnFocusShortBreak.disabled = true; if(btnFocusLongBreak) btnFocusLongBreak.disabled = true; if(btnFocusPause) btnFocusPause.disabled = false; }
             function updateFocusTimer() { if (focusTotalSeconds > 0) { focusTotalSeconds--; if(focusTimerDisplay) focusTimerDisplay.textContent = formatTime(focusTotalSeconds); } else { clearInterval(focusInterval); focusInterval = null; focusIsRunning = false; if(focusTimerDisplay) focusTimerDisplay.textContent = "00:00"; if(focusStatus) focusStatus.textContent = `🏁 ${focusCurrentMode} terminé !`; enableFocusStartButtons(); alert(`${focusCurrentMode} terminé !`); } }
             function startFocusTimer(durationSeconds, mode) { clearInterval(focusInterval); focusTotalSeconds = durationSeconds; focusCurrentMode = mode; focusIsRunning = true; if(focusTimerDisplay) focusTimerDisplay.textContent = formatTime(focusTotalSeconds); if(focusStatus) focusStatus.textContent = `⏳ ${mode} en cours...`; disableFocusStartButtons(); focusInterval = setInterval(updateFocusTimer, 1000); }
             function toggleFocusPause() { if (!focusInterval && !focusIsRunning && focusTotalSeconds <= 0) return; if (focusIsRunning) { clearInterval(focusInterval); focusInterval = null; focusIsRunning = false; if(focusStatus) focusStatus.textContent += " (⏸️ En pause)"; if(btnFocusPause) btnFocusPause.textContent = '▶️ Reprendre'; } else { focusIsRunning = true; if(focusStatus) focusStatus.textContent = `⏳ ${focusCurrentMode} en cours...`; if(btnFocusPause) btnFocusPause.textContent = '⏯️ Pause/Rep.'; focusInterval = setInterval(updateFocusTimer, 1000); } }
             function resetFocusTimer(defaultSeconds = POMODORO_DEFAULTS.work, defaultMode = 'Travail') { clearInterval(focusInterval); focusInterval = null; focusIsRunning = false; focusTotalSeconds = defaultSeconds; focusCurrentMode = defaultMode; if(focusTimerDisplay) focusTimerDisplay.textContent = formatTime(focusTotalSeconds); if(focusStatus) focusStatus.textContent = "Prêt."; enableFocusStartButtons(); }
             if(btnFocusStart) btnFocusStart.addEventListener('click', () => startFocusTimer(POMODORO_DEFAULTS.work, 'Travail'));
             if(btnFocusShortBreak) btnFocusShortBreak.addEventListener('click', () => startFocusTimer(POMODORO_DEFAULTS.shortBreak, 'Pause Courte'));
             if(btnFocusLongBreak) btnFocusLongBreak.addEventListener('click', () => startFocusTimer(POMODORO_DEFAULTS.longBreak, 'Pause Longue'));
             if(btnFocusPause) btnFocusPause.addEventListener('click', toggleFocusPause);
             if(btnFocusReset) btnFocusReset.addEventListener('click', () => resetFocusTimer());

             // --- Concentration: Game Logic ---
             function showTarget() { if(!gameArea || !gameTarget) return; const areaRect = gameArea.getBoundingClientRect(); const targetSize = 40; const top = Math.random() * (areaRect.height - targetSize); const left = Math.random() * (areaRect.width - targetSize); gameTarget.style.top = `${top}px`; gameTarget.style.left = `${left}px`; gameTarget.style.display = 'block'; gameStartTime = Date.now(); }
             function targetClicked() { if (!gameStartTime || !gameTarget) return; const reactionTime = Date.now() - gameStartTime; gameReactionTimes.push(reactionTime); gameScore++; gameTargetCount--; gameTarget.style.display = 'none'; gameStartTime = 0; updateGameInfo(); if (gameTargetCount > 0) { clearTimeout(gameTimeoutId); gameTimeoutId = setTimeout(showTarget, Math.random() * 1500 + 500); } else { if(btnStartGame) { btnStartGame.disabled = false; btnStartGame.textContent = "🚀 Relancer Jeu"; } const avgTime = gameReactionTimes.reduce((a, b) => a + b, 0) / gameReactionTimes.length; if(gameInfo) gameInfo.textContent += ` | Jeu Terminé ! Temps Moyen : ${avgTime.toFixed(0)} ms`; alert(`Jeu terminé !\nScore : ${gameScore}/10\nTemps moyen : ${avgTime.toFixed(0)} ms`); } }
             function updateGameInfo() { const avgTime = gameReactionTimes.length > 0 ? (gameReactionTimes.reduce((a, b) => a + b, 0) / gameReactionTimes.length).toFixed(0) : 'N/A'; if(gameInfo) gameInfo.textContent = `Score : ${gameScore} | Cibles restantes : ${gameTargetCount} | Temps moyen : ${avgTime} ms`; }
             function startGame() { gameScore = 0; gameTargetCount = 10; gameReactionTimes = []; gameStartTime = 0; if(btnStartGame) { btnStartGame.disabled = true; btnStartGame.textContent = "🕹️ Jeu en cours..."; } updateGameInfo(); clearTimeout(gameTimeoutId); gameTimeoutId = setTimeout(showTarget, 1000); }
             if(btnStartGame) btnStartGame.addEventListener('click', startGame);
             if(gameTarget) gameTarget.addEventListener('click', targetClicked);

             // --- Objectifs Logic ---
             function renderGoalItem(item) { return item ? item.text : 'Erreur'; }
             function loadAndRenderGoals() { const d = loadData(STORAGE_KEYS.GOALS, []); if(goalList) renderStyledList(d, goalList, renderGoalItem, STORAGE_KEYS.GOALS, { deletable: true, completable: true }); }
             if(btnAddGoal) btnAddGoal.addEventListener('click', () => { if(goalEntry) { const text = goalEntry.value.trim(); if (text) { const d = loadData(STORAGE_KEYS.GOALS, []); d.unshift({ id: Date.now(), text: text, completed: false }); saveData(STORAGE_KEYS.GOALS, d); loadAndRenderGoals(); goalEntry.value = ''; } else { alert('Veuillez entrer un objectif.'); }} });

             // --- Affirmations Logic ---
             function renderAffirmationItem(item) { return item ? item.text : 'Erreur'; }
             function showRandomAffirmation() { const userAffirmations = loadData(STORAGE_KEYS.AFFIRMATIONS, []); const allAffirmations = [...DEFAULT_AFFIRMATIONS, ...userAffirmations.map(a => a.text)]; let affirmation = "Ajoutez vos affirmations !"; if (allAffirmations.length > 0) { affirmation = `"${allAffirmations[Math.floor(Math.random() * allAffirmations.length)]}"`; } if(affirmationDisplay) affirmationDisplay.textContent = affirmation; }
             function loadAndRenderAffirmations() { const d = loadData(STORAGE_KEYS.AFFIRMATIONS, []); if(affirmationList) renderStyledList(d, affirmationList, renderAffirmationItem, STORAGE_KEYS.AFFIRMATIONS, { deletable: true }); showRandomAffirmation(); }
             if(btnAddAffirmation) btnAddAffirmation.addEventListener('click', () => { if(affirmationEntry) { const text = affirmationEntry.value.trim(); if (text) { const d = loadData(STORAGE_KEYS.AFFIRMATIONS, []); if (!d.some(a => a.text.toLowerCase() === text.toLowerCase())) { d.unshift({ id: Date.now(), text: text }); saveData(STORAGE_KEYS.AFFIRMATIONS, d); loadAndRenderAffirmations(); affirmationEntry.value = ''; } else { alert("Affirmation déjà existante."); } } else { alert('Entrez une affirmation.'); }} });
             if(btnNextAffirmation) btnNextAffirmation.addEventListener('click', showRandomAffirmation);

             // --- Inspiration Slideshow Logic ---
             function showSlide(index) {
                 //console.log(`DEBUG: showSlide CALLED with index: ${index}. Current index: ${currentSlideIndex}. Loading: ${isSlideshowLoading}`);
                 if (!slideshowImage) { console.error("DEBUG: showSlide FATAL - slideshowImage element NOT FOUND."); return; }
                 if (inspirationalImages.length === 0) { if(slideshowCaption) slideshowCaption.textContent = "Aucune image configurée."; return; }
                 if (isSlideshowLoading) { console.log("DEBUG: showSlide - Exiting early: loading."); return; }

                 isSlideshowLoading = true; slideshowImage.classList.remove('loaded');

                 if (index >= inspirationalImages.length) { currentSlideIndex = 0; }
                 else if (index < 0) { currentSlideIndex = inspirationalImages.length - 1; }
                 else { currentSlideIndex = index; }

                 const imageUrl = inspirationalImages[currentSlideIndex];
                 //console.log(`DEBUG: showSlide - Image URL to load: ${imageUrl}`);
                 if (!imageUrl) { console.error(`DEBUG: showSlide - Image URL is undefined for index ${currentSlideIndex}.`); isSlideshowLoading = false; return; }

                 const tempImage = new Image();
                 tempImage.onload = () => {
                     //console.log(`DEBUG: showSlide - tempImage.onload SUCCESS for ${imageUrl}`);
                     slideshowImage.src = imageUrl; slideshowImage.alt = `Image inspirante ${currentSlideIndex + 1}`;
                     if(slideshowCaption) slideshowCaption.textContent = `Image ${currentSlideIndex + 1} sur ${inspirationalImages.length}`;
                     requestAnimationFrame(() => { slideshowImage.classList.add('loaded'); isSlideshowLoading = false; });
                 };
                 tempImage.onerror = (err) => {
                     console.error(`DEBUG: showSlide - tempImage.onerror FAILURE for ${imageUrl}`, err);
                     slideshowImage.alt = "Erreur chargement image"; if(slideshowCaption) slideshowCaption.textContent = `Erreur image ${currentSlideIndex + 1}`;
                     slideshowImage.src = ""; slideshowImage.classList.remove('loaded'); isSlideshowLoading = false;
                 };
                 tempImage.src = imageUrl;
             }
             if (btnSlideshowNext && btnSlideshowPrev) { btnSlideshowNext.addEventListener('click', () => showSlide(currentSlideIndex + 1)); btnSlideshowPrev.addEventListener('click', () => showSlide(currentSlideIndex - 1)); }

             // --- Humeur Logic ---
             function renderMoodItem(item) { if (!item) return "Erreur"; const date = new Date(item.timestamp).toLocaleString('fr-FR', { dateStyle: 'short', timeStyle: 'short' }); const emoji = MOOD_EMOJIS[item.mood] || '❓'; return `${emoji} (${item.mood}/5) - <strong>${date}</strong><br><em>${item.note || 'Aucune note'}</em>`; }
             function loadAndRenderMoodHistory() { const d = loadData(STORAGE_KEYS.MOOD_HISTORY, []); if(moodHistoryList) renderStyledList(d.sort((a,b) => b.timestamp - a.timestamp), moodHistoryList, renderMoodItem, STORAGE_KEYS.MOOD_HISTORY, { deletable: true }); }
             if(moodOptionsContainer) moodOptionsContainer.addEventListener('click', (e) => { if (e.target.tagName === 'BUTTON' && e.target.dataset.mood) { moodOptionsContainer.querySelectorAll('button').forEach(btn => btn.classList.remove('selected')); e.target.classList.add('selected'); selectedMood = parseInt(e.target.dataset.mood, 10); } });
             if(btnSaveMood) btnSaveMood.addEventListener('click', () => { if (selectedMood === null) { alert("Sélectionnez une humeur."); return; } const note = moodNote ? moodNote.value.trim() : ''; const moodEntry = { id: Date.now(), timestamp: Date.now(), mood: selectedMood, note: note }; const history = loadData(STORAGE_KEYS.MOOD_HISTORY, []); history.push(moodEntry); saveData(STORAGE_KEYS.MOOD_HISTORY, history); loadAndRenderMoodHistory(); if(moodOptionsContainer) moodOptionsContainer.querySelectorAll('button').forEach(btn => btn.classList.remove('selected')); selectedMood = null; if(moodNote) moodNote.value = ''; alert("Humeur enregistrée !"); });

             // --- Paramètres: Data Management ---
             function getAllAppData() { const allData = {}; for (const key in STORAGE_KEYS) { if (key !== 'ALL_DATA' && key !== 'THEME') { allData[STORAGE_KEYS[key]] = loadData(STORAGE_KEYS[key], (STORAGE_KEYS[key] === STORAGE_KEYS.VISUALIZATION ? '' : [])); } } return allData; }
             if(btnExportData) btnExportData.addEventListener('click', () => { try { const dataStr = JSON.stringify(getAllAppData(), null, 2); const dataBlob = new Blob([dataStr], { type: 'application/json' }); const url = URL.createObjectURL(dataBlob); const link = document.createElement('a'); link.href = url; link.download = `awale_mental_data_${new Date().toISOString().slice(0, 10)}.json`; document.body.appendChild(link); link.click(); document.body.removeChild(link); URL.revokeObjectURL(url); alert("Données exportées."); } catch (e) { console.error("Export Error:", e); alert("Erreur exportation."); } });
             if(importFileInput) importFileInput.addEventListener('change', (event) => { const file = event.target.files[0]; if (!file) { if(importStatus) importStatus.textContent = "Aucun fichier."; return; } if (file.type !== 'application/json') { if(importStatus) importStatus.textContent = "Erreur: Fichier JSON requis."; return; } const reader = new FileReader(); reader.onload = (e) => { try { const importedData = JSON.parse(e.target.result); let importedCount = 0, skippedCount = 0; for (const key in importedData) { if (Object.values(STORAGE_KEYS).includes(key)) { const expectedType = (key === STORAGE_KEYS.VISUALIZATION) ? 'string' : 'object'; if ( (typeof importedData[key] === expectedType) || (expectedType === 'object' && Array.isArray(importedData[key]) ) ) { saveData(key, importedData[key]); importedCount++; } else { skippedCount++; } } else { skippedCount++; } } if(importStatus) importStatus.textContent = `Importation: ${importedCount} OK, ${skippedCount} ignoré(s). Rechargez l'app.`; alert("Données importées ! Rafraîchissez la page (F5)."); importFileInput.value = null; loadAllData(); } catch (err) { console.error("Import Parse Error:", err); if(importStatus) importStatus.textContent = "Erreur: JSON invalide."; alert("Erreur lecture JSON."); } }; reader.onerror = () => { console.error("Import Read Error"); if(importStatus) importStatus.textContent = "Erreur lecture fichier."; alert("Erreur lecture fichier."); }; reader.readAsText(file); });
             if(btnDeleteAllData) btnDeleteAllData.addEventListener('click', () => { if (confirm("⚠️ ATTENTION ! Supprimer TOUTES vos données ? Action IRRÉVERSIBLE.")) { if (confirm("Seconde confirmation : Vraiment sûr(e) ?")) { console.warn("Deleting all user data..."); let deletedCount = 0; for (const key in STORAGE_KEYS) { if (key !== 'THEME' && key !== 'ALL_DATA') { localStorage.removeItem(STORAGE_KEYS[key]); deletedCount++; } } alert("Toutes les données ont été supprimées."); location.reload(); } } });

            // --- Initialisation ---
            function loadAllData() {
                console.log("DEBUG: --- Starting initial data load ---");
                try {
                    const savedTheme = loadData(STORAGE_KEYS.THEME, 'light'); applyTheme(savedTheme);
                    if(quoteDisplay) showRandomAffirmation(); // Quote on home uses affirmations
                    if(visualizationText) visualizationText.value = loadData(STORAGE_KEYS.VISUALIZATION, '');
                    loadAndRenderSuccesses();
                    loadAndRenderStrengths();
                    loadAndRenderAnalyses();
                    if(analysisDate) analysisDate.valueAsDate = new Date();
                    if(focusTimerDisplay) resetFocusTimer(); // Init Pomodoro display
                    if(gameInfo) updateGameInfo(); // Init Game display
                    loadAndRenderGoals();
                    loadAndRenderAffirmations(); // Loads list + updates display
                    if (slideshowImage && inspirationalImages.length > 0) { showSlide(0); } else if (slideshowCaption) { slideshowCaption.textContent = "Aucune image trouvée."; }
                    loadAndRenderMoodHistory();
                    console.log("DEBUG: Initializing default active section...");
                    setActiveSection('accueil');
                    console.log("DEBUG: --- Initial data load FINISHED ---");
                } catch (error) {
                    console.error("FATAL ERROR during initial data load:", error);
                    alert("Une erreur critique est survenue lors du chargement initial de l'application. Vérifiez la console (F12).");
                }
            }

            // Execute initial load
            loadAllData();

        }); // Fin DOMContentLoaded
    </script>

</body>
</html>
